

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="https://cdn.acwing.com/media/user/profile/photo/196275_lg_23593e701b.jpeg">
  <link rel="icon" href="https://cdn.acwing.com/media/user/profile/photo/196275_lg_23593e701b.jpeg">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="ykexc">
  <meta name="keywords" content="">
  
    <meta name="description" content="设计模式 一份好的代码，离不开好的设计模式。设计模式总共有七大准则，二十多种设计模式都是根据七大准则来编写的。   单一职责 我们尽可能的让一个模块(类)只实现一个功能，在一些复杂的项目中如果一个类实现多个功能的话，那么整体逻辑会狼狈不堪，如果是小demo的话，那么就无所谓了。   开闭原则 软件实体（类、模块或方法）应该对扩展开放，对修改封闭。这意味着在添加新功能时，应该尽量通过扩展现有代码来实">
<meta property="og:type" content="article">
<meta property="og:title" content="设计模式">
<meta property="og:url" content="http://example.com/2024/03/20/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/index.html">
<meta property="og:site_name" content="ykexc">
<meta property="og:description" content="设计模式 一份好的代码，离不开好的设计模式。设计模式总共有七大准则，二十多种设计模式都是根据七大准则来编写的。   单一职责 我们尽可能的让一个模块(类)只实现一个功能，在一些复杂的项目中如果一个类实现多个功能的话，那么整体逻辑会狼狈不堪，如果是小demo的话，那么就无所谓了。   开闭原则 软件实体（类、模块或方法）应该对扩展开放，对修改封闭。这意味着在添加新功能时，应该尽量通过扩展现有代码来实">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://image.itbaima.cn/images/76/image-20240320005539610.jpeg">
<meta property="article:published_time" content="2024-03-19T16:26:55.000Z">
<meta property="article:modified_time" content="2024-03-19T16:45:20.902Z">
<meta property="article:author" content="ykexc">
<meta property="article:tag" content="设计模式">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="https://image.itbaima.cn/images/76/image-20240320005539610.jpeg">
  
  
  
  <title>设计模式 - ykexc</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/KaTeX/0.16.2/katex.min.css" />



<!-- 主题依赖的图标库，不要自行修改 -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_hj8rtnfg7um.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_lbnruvf0jn.css">


<link  rel="stylesheet" href="/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css" />
  




  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"example.com","root":"/","version":"1.9.4","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"left","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":false,"follow_dnt":true,"baidu":null,"google":null,"gtag":null,"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":null,"app_key":null,"server_url":null,"path":"window.location.pathname","ignore_local":false}},"search_path":"/local-search.xml"};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
  


  
<meta name="generator" content="Hexo 6.3.0"></head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 70vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>ykexc</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-fill"></i>
                <span>首页</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/">
                <i class="iconfont icon-archive-fill"></i>
                <span>归档</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/">
                <i class="iconfont icon-category-fill"></i>
                <span>分类</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/">
                <i class="iconfont icon-tags-fill"></i>
                <span>标签</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/">
                <i class="iconfont icon-user-fill"></i>
                <span>关于</span>
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              <i class="iconfont icon-search"></i>
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">
              <i class="iconfont icon-dark" id="color-toggle-icon"></i>
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('https://image.itbaima.cn/images/76/image-20240320005539610.jpeg') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text="设计模式"></span>
          
        </div>

        
          
  <div class="mt-3">
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2024-03-20 00:26" pubdate>
          2024年3月20日 凌晨
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          69k 字
        
      </span>
    

    
      <span class="post-meta mr-2">
        <i class="iconfont icon-clock-fill"></i>
        
        
        
          575 分钟
        
      </span>
    

    
    
      
        <span id="leancloud-page-views-container" class="post-meta" style="display: none">
          <i class="iconfont icon-eye" aria-hidden="true"></i>
          <span id="leancloud-page-views"></span> 次
        </span>
        
      
    
  </div>


        
      </div>

      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="padding-left: 2rem; margin-right: -1rem">
    <div id="toc">
  <p class="toc-header">
    <i class="iconfont icon-list"></i>
    <span>目录</span>
  </p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <!-- SEO header -->
            <h1 style="display: none">设计模式</h1>
            
            
              <div class="markdown-body">
                
                <h1>设计模式</h1>
<p>一份好的代码，离不开好的设计模式。设计模式总共有七大准则，二十多种设计模式都是根据七大准则来编写的。</p>
<ul>
<li>
<p><strong>单一职责</strong></p>
<p>我们尽可能的让一个模块(类)只实现一个功能，在一些复杂的项目中如果一个类实现多个功能的话，那么整体逻辑会狼狈不堪，如果是小demo的话，那么就无所谓了。</p>
</li>
<li>
<p><strong>开闭原则</strong></p>
<p>软件实体（类、模块或方法）应该对扩展开放，对修改封闭。这意味着在添加新功能时，应该尽量通过扩展现有代码来实现，而不是修改现有代码。</p>
</li>
<li>
<p><strong>里氏替换原则</strong></p>
<p>基类使用的地方子类一定可以使用，反之不行。</p>
</li>
<li>
<p><strong>接口隔离原则</strong></p>
<p>接口的粒度应该细化，使得客户端只用到它自己需要的接口</p>
</li>
<li>
<p><strong>依赖倒置原则</strong></p>
<p>高层模块不应该依赖于低层模块，它们都应该依赖于抽象。抽象不应该依赖于细节，细节应该依赖于抽象。</p>
</li>
<li>
<p><strong>合成复用原则</strong></p>
<p>尽量使用组合和聚合，而不是继承，来实现代码复用。</p>
</li>
<li>
<p><strong>迪米特原则</strong></p>
<p>一个对象应该对另一个对象有最少的了解。换句话说，一个对象应该只与直接相关的其他对象进行通信，而避免与无关的对象进行交互。</p>
</li>
</ul>
<p>设计模式总体分为三类：创建型模式，结构型模式，行为模式。</p>
<p>创建型模式：这类模式提供创建对象的机制， 能够提升已有代码的灵活性和可复⽤性。主要有：工厂、抽象、建造、原型、单例。</p>
<p>结构型模式：这类模式介绍如何将对象和类组装成较⼤的结构， 并同时保持结构的灵活和⾼效。主要有：适配器、桥接、组合、装饰、外观、亨元、代理。</p>
<p>行为型模式：这类模式负责对象间的⾼效沟通和职责委派。主要有：责任链、命令、迭代器、中介者、备忘录、观察者、状态、策略、模板、访问者。</p>
<blockquote>
<p>所有案例代码: <a target="_blank" rel="noopener" href="https://github.com/ykexc/Design">https://github.com/ykexc/Design</a></p>
</blockquote>
<h3 id="工厂-方法-模式">工厂(方法)模式</h3>
<blockquote>
<p>场景:在发放奖品的场景下，有着不同类别的奖品(实物，优惠券，其他…),入参和出参均不同，通过工厂方法模式统一入参，提高代码扩展性，减少if else</p>
</blockquote>
<p>文件目录</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs java">├─awards<br>│      Coupon.java<br>│      Goods.java<br>│      IQIYICard.java<br>│      <br>├─req<br>│      GoodsReq.java<br>│<br>├─resp<br>│      GoodsResp.java<br>│<br>├─service<br>│      CouponService.java<br>│      GoodsService.java<br>│      IQIYICardService.java<br>│<br>└─store<br>    │  ICommodity.java<br>    │  StoreFactory.java<br>    │<br>    └─impl<br>            CouponCommodityImpl.java<br>            GoodsCommodityImpl.java<br>            OtherCommodityImpl.java<br></code></pre></td></tr></table></figure>
<p><code>coupon</code>,<code>goods</code>,<code>iqiyi</code>分别代表着三种不同类别的奖品，service中是三种不同奖品发放的逻辑，入参出参不同，通过定义<code>ICommodity</code>接口统一入参，并实现三种不同方式的发放逻辑，通过<code>StoreFactory</code>进行最路由处理，使代码变得比较整洁干净，易于扩展。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CouponService</span> &#123;<br><br>    <span class="hljs-keyword">public</span> Coupon <span class="hljs-title function_">sendCoupon</span><span class="hljs-params">(String uid, String couponId, String uuid)</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;发送优惠券成功: uid: &quot;</span> + uid + <span class="hljs-string">&quot; couponId: &quot;</span> + couponId + <span class="hljs-string">&quot; uid: &quot;</span> + uid);<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Coupon</span>(<span class="hljs-string">&quot;0x3f3f3f3f&quot;</span>, <span class="hljs-string">&quot;普通优惠券&quot;</span>);<br>    &#125;<br><br>&#125;<br><br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">GoodsService</span> &#123;<br><br><br>    <span class="hljs-keyword">public</span> GoodsResp <span class="hljs-title function_">sendGoods</span><span class="hljs-params">(</span><br><span class="hljs-params">            GoodsReq req</span><br><span class="hljs-params">    )</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;实物奖品发放成功: &quot;</span> + <span class="hljs-string">&quot;uid: &quot;</span> + req.uid() + <span class="hljs-string">&quot; address: &quot;</span> + req.address());<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">GoodsResp</span>(req.uid(), req.address(), req.phone(), <span class="hljs-keyword">new</span> <span class="hljs-title class_">Goods</span>(<span class="hljs-string">&quot;abc&quot;</span>, <span class="hljs-string">&quot;一本书&quot;</span>));<br>    &#125;<br><br>&#125;<br><br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">IQIYICardService</span> &#123;<br><br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">grantToken</span><span class="hljs-params">(String uid, String bindMobileNumber)</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;模拟发放爱奇艺会员卡一张：&quot;</span> + bindMobileNumber + <span class="hljs-string">&quot;，&quot;</span> + <span class="hljs-keyword">new</span> <span class="hljs-title class_">IQIYICard</span>(<span class="hljs-string">&quot;0x3f3f3f3f&quot;</span>));<br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">ICommodity</span> &#123;<br><br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">sendCommodity</span><span class="hljs-params">(Map&lt;String, String&gt; param)</span>;<br><br>&#125;<br></code></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CouponCommodityImpl</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">ICommodity</span> &#123;<br><br>    <span class="hljs-type">CouponService</span> <span class="hljs-variable">couponService</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">CouponService</span>();<br><br>    <span class="hljs-type">Logger</span> <span class="hljs-variable">logger</span> <span class="hljs-operator">=</span> LoggerFactory.getLogger(CouponCommodityImpl.class);<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">sendCommodity</span><span class="hljs-params">(Map&lt;String, String&gt; param)</span> &#123;<br>        <span class="hljs-type">Coupon</span> <span class="hljs-variable">coupon</span> <span class="hljs-operator">=</span> couponService.sendCoupon(param.get(<span class="hljs-string">&quot;uid&quot;</span>), param.get(<span class="hljs-string">&quot;couponId&quot;</span>), param.get(<span class="hljs-string">&quot;uuid&quot;</span>));<br>        logger.info(<span class="hljs-string">&quot;优惠券发放成功: &#123;&#125;: &#123;&#125;&quot;</span>, coupon.cardId(), coupon.info());<br>    &#125;<br>&#125;<br><br><br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">GoodsCommodityImpl</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">ICommodity</span> &#123;<br><br>    <span class="hljs-type">Logger</span> <span class="hljs-variable">logger</span> <span class="hljs-operator">=</span> LoggerFactory.getLogger(GoodsCommodityImpl.class);<br><br>    <span class="hljs-type">GoodsService</span> <span class="hljs-variable">goodsService</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">GoodsService</span>();<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">sendCommodity</span><span class="hljs-params">(Map&lt;String, String&gt; param)</span> &#123;<br>        <span class="hljs-type">GoodsResp</span> <span class="hljs-variable">goodsResp</span> <span class="hljs-operator">=</span> goodsService.sendGoods(JSON.parseObject(param.get(<span class="hljs-string">&quot;goodsReq&quot;</span>), GoodsReq.class));<br>        logger.info(<span class="hljs-string">&quot;实物发放成功, &#123;&#125;: &#123;&#125; :&#123;&#125;&quot;</span>, goodsResp.uid(), goodsResp.goods(), goodsResp.address());<br>    &#125;<br>&#125;<br><br><br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OtherCommodityImpl</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">ICommodity</span> &#123;<br><br><br>    <span class="hljs-type">IQIYICardService</span> <span class="hljs-variable">iqiyiCardService</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IQIYICardService</span>();<br><br>    <span class="hljs-type">Logger</span> <span class="hljs-variable">logger</span> <span class="hljs-operator">=</span> LoggerFactory.getLogger(OtherCommodityImpl.class);<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">sendCommodity</span><span class="hljs-params">(Map&lt;String, String&gt; param)</span> &#123;<br>        iqiyiCardService.grantToken(param.get(<span class="hljs-string">&quot;uid&quot;</span>), param.get(<span class="hljs-string">&quot;bindMobileNumber&quot;</span>));<br>        logger.info(<span class="hljs-string">&quot;发送爱奇艺月卡成功&quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">StoreFactory</span> &#123;<br><br>    GoodsCommodityImpl goodsCommodity;<br>    CouponCommodityImpl couponCommodity;<br><br>    OtherCommodityImpl otherCommodity;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">StoreFactory</span><span class="hljs-params">()</span> &#123;<br>        goodsCommodity = <span class="hljs-keyword">new</span> <span class="hljs-title class_">GoodsCommodityImpl</span>();<br>        couponCommodity = <span class="hljs-keyword">new</span> <span class="hljs-title class_">CouponCommodityImpl</span>();<br>        otherCommodity = <span class="hljs-keyword">new</span> <span class="hljs-title class_">OtherCommodityImpl</span>();<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> ICommodity <span class="hljs-title function_">getCommodity</span><span class="hljs-params">(Integer commodityType)</span> <span class="hljs-keyword">throws</span> IllegalAccessException &#123;<br>        <span class="hljs-keyword">if</span> (<span class="hljs-literal">null</span> == commodityType) <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>        <span class="hljs-keyword">if</span> (commodityType.equals(<span class="hljs-number">1</span>)) <span class="hljs-keyword">return</span> goodsCommodity;<br>        <span class="hljs-keyword">if</span> (commodityType.equals(<span class="hljs-number">2</span>)) <span class="hljs-keyword">return</span> couponCommodity;<br>        <span class="hljs-keyword">if</span> (commodityType.equals(<span class="hljs-number">3</span>)) <span class="hljs-keyword">return</span> otherCommodity;<br>        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalAccessException</span>(<span class="hljs-string">&quot;错误的类型&quot;</span>);<br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">FactoryTest</span> &#123;<br><br><br>    <span class="hljs-type">StoreFactory</span> <span class="hljs-variable">storeFactory</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">StoreFactory</span>();<br><br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">test</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> IllegalAccessException &#123;<br>        <span class="hljs-type">ICommodity</span> <span class="hljs-variable">commodity1</span> <span class="hljs-operator">=</span> storeFactory.getCommodity(<span class="hljs-number">1</span>);<br><br>        commodity1.sendCommodity(Map.of(<span class="hljs-string">&quot;goodsReq&quot;</span>, JSON.toJSONString(<span class="hljs-keyword">new</span> <span class="hljs-title class_">GoodsReq</span>(<span class="hljs-string">&quot;012&quot;</span>, <span class="hljs-string">&quot;陕西省咸阳市&quot;</span>, <span class="hljs-string">&quot;15229602304&quot;</span>))));<br><br>        <span class="hljs-type">ICommodity</span> <span class="hljs-variable">commodity2</span> <span class="hljs-operator">=</span> storeFactory.getCommodity(<span class="hljs-number">2</span>);<br><br>        commodity2.sendCommodity(Map.of(<span class="hljs-string">&quot;uid&quot;</span>, <span class="hljs-string">&quot;124&quot;</span>, <span class="hljs-string">&quot;couponId&quot;</span>, <span class="hljs-string">&quot;2344&quot;</span>, <span class="hljs-string">&quot;uuid&quot;</span>, <span class="hljs-string">&quot;sdfd23453&quot;</span>));<br><br>        <span class="hljs-type">ICommodity</span> <span class="hljs-variable">commodity3</span> <span class="hljs-operator">=</span> storeFactory.getCommodity(<span class="hljs-number">3</span>);<br><br>        commodity3.sendCommodity(Map.of(<span class="hljs-string">&quot;bindMobileNumber&quot;</span>, <span class="hljs-string">&quot;sdssfdff233&quot;</span>, <span class="hljs-string">&quot;uid&quot;</span>, <span class="hljs-string">&quot;4554&quot;</span>));<br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure>
<p>总结: 在工厂(方法)模式中，避免了创建者和产品逻辑的相互耦合，使用指定的工厂进行分配指定的实现，统一的入参，满足了单一职责，开闭原则。但也存在缺点，如果种类特别多的话就得需要很多类 。</p>
<h3 id="抽象工厂模式">抽象工厂模式</h3>
<blockquote>
<p>场景: 对于系统的主题有多种，但都遵循统一的实现，基于抽象工厂模式，动态的采用不同的工厂生产出不同的对象</p>
</blockquote>
<p>文件目录</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs java">├─Theme<br>│  │  I.java<br>│  │  IAdapter.java<br>│  │  <span class="hljs-keyword">package</span>-info.java<br>│  │  T1.java<br>│  │  T2.java<br>│  │<br>│  ├─impl<br>│  │      Impl.java<br>│  │      T1Impl.java<br>│  │      T2Impl.java<br>│  │<br>│  └─proxy<br>│      ├─cglib<br>│      │      CGLIBMethodIntercept.java<br>│      │      CGLIBProxy.java<br>│      │<br>│      └─jdk<br>│              JDKInvocationHandler.java<br>│              JDKProxy.java<br>│<br>└─util<br>        ClassLoaderUtils.java<br></code></pre></td></tr></table></figure>
<p><code>I</code>、<code>Impl</code>作为系统的默认主题，<code>T1</code>、<code>T2</code>分别为两个自定义主题，其中的核心方法都是一样的，方法签名都是一样的，共有两个抽象工厂<code>jdk_proxy</code>和<code>cglib_proxy</code>都可以实现对象的创建，通过动态指定不同工厂生产同种类型的对象。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//默认主题实现</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">I</span> &#123;<br><br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">f1</span><span class="hljs-params">()</span>;<br><br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">f2</span><span class="hljs-params">()</span>;<br><br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">f3</span><span class="hljs-params">()</span>;<br><br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">f4</span><span class="hljs-params">()</span>;<br><br>&#125;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Impl</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">I</span> &#123;<br><br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">f1</span><span class="hljs-params">()</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;ST f1&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">f2</span><span class="hljs-params">()</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;ST f2&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">f3</span><span class="hljs-params">()</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;ST f3&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">f4</span><span class="hljs-params">()</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;ST f4&quot;</span>);<br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//两中的自定义主题</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">T1</span> &#123;<br><br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">f1T1</span><span class="hljs-params">()</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;这是T1调色功能&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">f2T1</span><span class="hljs-params">()</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;这是T1组件功能&quot;</span>);<br>    &#125;<br><br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">f3T1</span><span class="hljs-params">()</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;这是T1放大功能&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">f4T1</span><span class="hljs-params">()</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;这是T1缩小功能&quot;</span>);<br>    &#125;<br><br><br>&#125;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">T2</span> &#123;<br><br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">f1T2</span><span class="hljs-params">()</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;这是T2调色功能&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">f2T2</span><span class="hljs-params">()</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;这是T2组件功能&quot;</span>);<br>    &#125;<br><br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">f3T2</span><span class="hljs-params">()</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;这是T2放大功能&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">f4T2</span><span class="hljs-params">()</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;这是T2缩小功能&quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//通过适配器来适配默认的方法</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">IAdapter</span> &#123;<br><br><br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">f1</span><span class="hljs-params">()</span>;<br><br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">f2</span><span class="hljs-params">()</span>;<br><br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">f3</span><span class="hljs-params">()</span>;<br><br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">f4</span><span class="hljs-params">()</span>;<br><br>&#125;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">T1Impl</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">IAdapter</span> &#123;<br><br>    <span class="hljs-type">T1</span> <span class="hljs-variable">t1</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">T1</span>();<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">f1</span><span class="hljs-params">()</span> &#123;<br>        t1.f1T1();<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">f2</span><span class="hljs-params">()</span> &#123;<br>        t1.f2T1();<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">f3</span><span class="hljs-params">()</span> &#123;<br>        t1.f3T1();<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">f4</span><span class="hljs-params">()</span> &#123;<br>        t1.f4T1();<br>    &#125;<br>&#125;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">T2Impl</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">IAdapter</span> &#123;<br><br><br>    <span class="hljs-type">T2</span> <span class="hljs-variable">t2</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">T2</span>();<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">f1</span><span class="hljs-params">()</span> &#123;<br>        t2.f1T2();<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">f2</span><span class="hljs-params">()</span> &#123;<br>        t2.f2T2();<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">f3</span><span class="hljs-params">()</span> &#123;<br>        t2.f3T2();<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">f4</span><span class="hljs-params">()</span> &#123;<br>        t2.f4T2();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//JDK_Proxy实现</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">JDKInvocationHandler</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">InvocationHandler</span> &#123;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> IAdapter iAdapter;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">JDKInvocationHandler</span><span class="hljs-params">(IAdapter iAdapter)</span> &#123;<br>        <span class="hljs-built_in">this</span>.iAdapter = iAdapter;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">invoke</span><span class="hljs-params">(Object proxy, Method method, Object[] args)</span> <span class="hljs-keyword">throws</span> Throwable &#123;<br>        <span class="hljs-keyword">return</span> IAdapter.class.getMethod(method.getName(), ClassLoaderUtils.getClazzByArgs(args)).invoke(iAdapter, args);<br>    &#125;<br>&#125;<br><br><span class="hljs-meta">@SuppressWarnings(&quot;unchecked&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">JDKProxy</span> &#123;<br><br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span>&lt;T&gt; T <span class="hljs-title function_">getProxy</span><span class="hljs-params">(Class&lt;T&gt; clazz, IAdapter adapter)</span> &#123;<br>        <span class="hljs-type">JDKInvocationHandler</span> <span class="hljs-variable">jdkInvocationHandler</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">JDKInvocationHandler</span>(adapter);<br>        <span class="hljs-type">ClassLoader</span> <span class="hljs-variable">classLoader</span> <span class="hljs-operator">=</span> clazz.getClassLoader();<br>        <span class="hljs-keyword">return</span> (T) Proxy.newProxyInstance(classLoader, clazz.getInterfaces(), jdkInvocationHandler);<br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//cglib_proxy实现</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CGLIBMethodIntercept</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">MethodInterceptor</span> &#123;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> IAdapter adapter;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">CGLIBMethodIntercept</span><span class="hljs-params">(IAdapter adapter)</span> &#123;<br>        <span class="hljs-built_in">this</span>.adapter = adapter;<br>    &#125;<br><br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">intercept</span><span class="hljs-params">(Object o, Method method, Object[] objects, MethodProxy methodProxy)</span> <span class="hljs-keyword">throws</span> Throwable &#123;<br>        <span class="hljs-keyword">return</span> IAdapter.class.getMethod(method.getName(), ClassLoaderUtils.getClazzByArgs(objects)).invoke(adapter, objects);<br>    &#125;<br>&#125;<br><br><span class="hljs-meta">@SuppressWarnings(&quot;unchecked&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CGLIBProxy</span> &#123;<br><br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> &lt;T&gt; T <span class="hljs-title function_">getProxy</span><span class="hljs-params">(Class&lt;T&gt; clazz, IAdapter adapter)</span> &#123;<br>        <span class="hljs-keyword">return</span> (T) Enhancer.create(clazz, <span class="hljs-keyword">new</span> <span class="hljs-title class_">CGLIBMethodIntercept</span>(adapter));<br>    &#125;<br><br><br>&#125;<br></code></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ClassLoaderUtils</span> &#123;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> Set&lt;Class&gt; primitiveSet = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashSet</span>&lt;Class&gt;();<br><br>    <span class="hljs-keyword">static</span> &#123;<br>        primitiveSet.add(Integer.class);<br>        primitiveSet.add(Long.class);<br>        primitiveSet.add(Float.class);<br>        primitiveSet.add(Byte.class);<br>        primitiveSet.add(Short.class);<br>        primitiveSet.add(Double.class);<br>        primitiveSet.add(Character.class);<br>        primitiveSet.add(Boolean.class);<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 得到当前ClassLoader</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> ClassLoader</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> ClassLoader <span class="hljs-title function_">getCurrentClassLoader</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-type">ClassLoader</span> <span class="hljs-variable">cl</span> <span class="hljs-operator">=</span> Thread.currentThread().getContextClassLoader();<br>        <span class="hljs-keyword">if</span> (cl == <span class="hljs-literal">null</span>) &#123;<br>            cl = ClassLoaderUtils.class.getClassLoader();<br>        &#125;<br>        <span class="hljs-keyword">return</span> cl == <span class="hljs-literal">null</span> ? ClassLoader.getSystemClassLoader() : cl;<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 得到当前ClassLoader</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> clazz 某个类</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> ClassLoader</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> ClassLoader <span class="hljs-title function_">getClassLoader</span><span class="hljs-params">(Class&lt;?&gt; clazz)</span> &#123;<br>        <span class="hljs-type">ClassLoader</span> <span class="hljs-variable">loader</span> <span class="hljs-operator">=</span> Thread.currentThread().getContextClassLoader();<br>        <span class="hljs-keyword">if</span> (loader != <span class="hljs-literal">null</span>) &#123;<br>            <span class="hljs-keyword">return</span> loader;<br>        &#125;<br>        <span class="hljs-keyword">if</span> (clazz != <span class="hljs-literal">null</span>) &#123;<br>            loader = clazz.getClassLoader();<br>            <span class="hljs-keyword">if</span> (loader != <span class="hljs-literal">null</span>) &#123;<br>                <span class="hljs-keyword">return</span> loader;<br>            &#125;<br>            <span class="hljs-keyword">return</span> clazz.getClassLoader();<br>        &#125;<br>        <span class="hljs-keyword">return</span> ClassLoader.getSystemClassLoader();<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 根据类名加载Class</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> className 类名</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> Class</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@throws</span> ClassNotFoundException 找不到类</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Class <span class="hljs-title function_">forName</span><span class="hljs-params">(String className)</span><br>            <span class="hljs-keyword">throws</span> ClassNotFoundException &#123;<br>        <span class="hljs-keyword">return</span> forName(className, <span class="hljs-literal">true</span>);<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 根据类名加载Class</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> className  类名</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> initialize 是否初始化</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> Class</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@throws</span> ClassNotFoundException 找不到类</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Class <span class="hljs-title function_">forName</span><span class="hljs-params">(String className, <span class="hljs-type">boolean</span> initialize)</span><br>            <span class="hljs-keyword">throws</span> ClassNotFoundException &#123;<br>        <span class="hljs-keyword">return</span> Class.forName(className, initialize, getCurrentClassLoader());<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 根据类名加载Class</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> className 类名</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> cl        Classloader</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> Class</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@throws</span> ClassNotFoundException 找不到类</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Class <span class="hljs-title function_">forName</span><span class="hljs-params">(String className, ClassLoader cl)</span><br>            <span class="hljs-keyword">throws</span> ClassNotFoundException &#123;<br>        <span class="hljs-keyword">return</span> Class.forName(className, <span class="hljs-literal">true</span>, cl);<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 实例化一个对象(只检测默认构造函数，其它不管）</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> clazz 对象类</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> &lt;T&gt;   对象具体类</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> 对象实例</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@throws</span> Exception 没有找到方法，或者无法处理，或者初始化方法异常等</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> &lt;T&gt; T <span class="hljs-title function_">newInstance</span><span class="hljs-params">(Class&lt;T&gt; clazz)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        <span class="hljs-keyword">if</span> (primitiveSet.contains(clazz)) &#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>        &#125;<br>        <span class="hljs-keyword">if</span> (clazz.isMemberClass() &amp;&amp; !Modifier.isStatic(clazz.getModifiers())) &#123;<br>            Constructor constructorList[] = clazz.getDeclaredConstructors();<br>            <span class="hljs-type">Constructor</span> <span class="hljs-variable">defaultConstructor</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;<br>            <span class="hljs-keyword">for</span> (Constructor con : constructorList) &#123;<br>                <span class="hljs-keyword">if</span> (con.getParameterTypes().length == <span class="hljs-number">1</span>) &#123;<br>                    defaultConstructor = con;<br>                    <span class="hljs-keyword">break</span>;<br>                &#125;<br>            &#125;<br>            <span class="hljs-keyword">if</span> (defaultConstructor != <span class="hljs-literal">null</span>) &#123;<br>                <span class="hljs-keyword">if</span> (defaultConstructor.isAccessible()) &#123;<br>                    <span class="hljs-keyword">return</span> (T) defaultConstructor.newInstance(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>[]&#123;<span class="hljs-literal">null</span>&#125;);<br>                &#125; <span class="hljs-keyword">else</span> &#123;<br>                    <span class="hljs-keyword">try</span> &#123;<br>                        defaultConstructor.setAccessible(<span class="hljs-literal">true</span>);<br>                        <span class="hljs-keyword">return</span> (T) defaultConstructor.newInstance(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>[]&#123;<span class="hljs-literal">null</span>&#125;);<br>                    &#125; <span class="hljs-keyword">finally</span> &#123;<br>                        defaultConstructor.setAccessible(<span class="hljs-literal">false</span>);<br>                    &#125;<br>                &#125;<br>            &#125; <span class="hljs-keyword">else</span> &#123;<br>                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Exception</span>(<span class="hljs-string">&quot;The &quot;</span> + clazz.getCanonicalName() + <span class="hljs-string">&quot; has no default constructor!&quot;</span>);<br>            &#125;<br>        &#125;<br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-keyword">return</span> clazz.newInstance();<br>        &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>            Constructor&lt;T&gt; constructor = clazz.getDeclaredConstructor();<br>            <span class="hljs-keyword">if</span> (constructor.isAccessible()) &#123;<br>                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Exception</span>(<span class="hljs-string">&quot;The &quot;</span> + clazz.getCanonicalName() + <span class="hljs-string">&quot; has no default constructor!&quot;</span>, e);<br>            &#125; <span class="hljs-keyword">else</span> &#123;<br>                <span class="hljs-keyword">try</span> &#123;<br>                    constructor.setAccessible(<span class="hljs-literal">true</span>);<br>                    <span class="hljs-keyword">return</span> constructor.newInstance();<br>                &#125; <span class="hljs-keyword">finally</span> &#123;<br>                    constructor.setAccessible(<span class="hljs-literal">false</span>);<br>                &#125;<br>            &#125;<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Class&lt;?&gt;[] getClazzByArgs(Object[] args) &#123;<br>        <span class="hljs-keyword">if</span> (args == <span class="hljs-literal">null</span>) <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Class</span>[<span class="hljs-number">0</span>];<br>        Class&lt;?&gt;[] parameterTypes = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Class</span>[args.length];<br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; args.length; i++) &#123;<br>            <span class="hljs-keyword">if</span> (args[i] <span class="hljs-keyword">instanceof</span> ArrayList) &#123;<br>                parameterTypes[i] = List.class;<br>                <span class="hljs-keyword">continue</span>;<br>            &#125;<br>            <span class="hljs-keyword">if</span> (args[i] <span class="hljs-keyword">instanceof</span> LinkedList) &#123;<br>                parameterTypes[i] = List.class;<br>                <span class="hljs-keyword">continue</span>;<br>            &#125;<br>            <span class="hljs-keyword">if</span> (args[i] <span class="hljs-keyword">instanceof</span> HashMap) &#123;<br>                parameterTypes[i] = Map.class;<br>                <span class="hljs-keyword">continue</span>;<br>            &#125;<br>            <span class="hljs-keyword">if</span> (args[i] <span class="hljs-keyword">instanceof</span> Long) &#123;<br>                parameterTypes[i] = <span class="hljs-type">long</span>.class;<br>                <span class="hljs-keyword">continue</span>;<br>            &#125;<br>            <span class="hljs-keyword">if</span> (args[i] <span class="hljs-keyword">instanceof</span> Double) &#123;<br>                parameterTypes[i] = <span class="hljs-type">double</span>.class;<br>                <span class="hljs-keyword">continue</span>;<br>            &#125;<br>            <span class="hljs-keyword">if</span> (args[i] <span class="hljs-keyword">instanceof</span> TimeUnit) &#123;<br>                parameterTypes[i] = TimeUnit.class;<br>                <span class="hljs-keyword">continue</span>;<br>            &#125;<br>            parameterTypes[i] = args[i].getClass();<br>        &#125;<br>        <span class="hljs-keyword">return</span> parameterTypes;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> Method <span class="hljs-title function_">getMethod</span><span class="hljs-params">(Class&lt;?&gt; classType, String methodName, Class&lt;?&gt;... parameterTypes)</span> <span class="hljs-keyword">throws</span> NoSuchMethodException &#123;<br>        <span class="hljs-keyword">return</span> classType.getMethod(methodName, parameterTypes);<br>    &#125;<br><br>&#125;<br><br></code></pre></td></tr></table></figure>
<p>总结: 抽象工厂和工厂方法的本质都是为了创建对象，两者本质上的区别在于一个是直接创建对象，一个是先创建工厂再创建对象，抽象工厂的更灵活一点，科以动态指定不同的工厂，两者还有一点不同的就是工厂方法可以创建类型完全不一样的对象，而抽象工厂更适合创建同类型的对象。</p>
<h3 id="建造者模式">建造者模式</h3>
<blockquote>
<p>场景: 在点餐时通过不同的菜品组成不同的套餐，可以使用建造者模式使得代码更加整洁，对于新增套餐省去if else</p>
</blockquote>
<p>文件目录</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs java">food<br>    │  Builder.java<br>    │  IMenu.java<br>    │  Matter.java<br>    │  Pack.java<br>    │  <br>    ├─beverage<br>    │      Noodles.java<br>    │      Rice.java<br>    │      <br>    ├─dishes<br>    │      ColdDish.java<br>    │      HotDish.java<br>    │      <br>    └─staplefood<br>            CocaCola.java<br>            PepsiCola.java<br></code></pre></td></tr></table></figure>
<p>食品总共有<code>beverage</code>、<code>dishes</code>、<code>staplefood</code>三种类型，都是基于食品的规范<code>Matter</code>来实现的，基于不同的组合可以实现不同级别的套餐，定义<code>IMenu</code>接口采取返回原类这种格式，通过<code>Pack</code>来实现，在<code>Builder</code>里面定义不同的级别的组合方式，最后只需要在<code>Builder</code>里面选取所需要的级别即可。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">Matter</span> &#123;<br><br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 类型</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> String</span><br><span class="hljs-comment">     */</span><br>    String <span class="hljs-title function_">scene</span><span class="hljs-params">()</span>;<br><br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 品牌</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> String</span><br><span class="hljs-comment">     */</span><br>    String <span class="hljs-title function_">brand</span><span class="hljs-params">()</span>;<br><br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 价格</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> BigDecimal</span><br><span class="hljs-comment">     */</span><br>    BigDecimal <span class="hljs-title function_">price</span><span class="hljs-params">()</span>;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 描述</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> String</span><br><span class="hljs-comment">     */</span><br>    String <span class="hljs-title function_">desc</span><span class="hljs-params">()</span>;<br><br>&#125;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Noodles</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Matter</span> &#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">scene</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;主食&quot;</span>;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">brand</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;香雪&quot;</span>;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> BigDecimal <span class="hljs-title function_">price</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> BigDecimal.valueOf(<span class="hljs-number">54.9</span>);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">desc</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;普通面条&quot;</span>;<br>    &#125;<br>&#125;<br><br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Rice</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Matter</span> &#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">scene</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;主食&quot;</span>;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">brand</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;金龙鱼&quot;</span>;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> BigDecimal <span class="hljs-title function_">price</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> BigDecimal.valueOf(<span class="hljs-number">55.3</span>);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">desc</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;普通的金龙鱼大米&quot;</span>;<br>    &#125;<br>&#125;<br><br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ColdDish</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Matter</span> &#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">scene</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;菜品&quot;</span>;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">brand</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;一级&quot;</span>;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> BigDecimal <span class="hljs-title function_">price</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> BigDecimal.valueOf(<span class="hljs-number">15.8</span>);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">desc</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;一级凉菜，挺好吃&quot;</span>;<br>    &#125;<br>&#125;<br><br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HotDish</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Matter</span> &#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">scene</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;菜品&quot;</span>;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">brand</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;一级&quot;</span>;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> BigDecimal <span class="hljs-title function_">price</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> BigDecimal.valueOf(<span class="hljs-number">9.6</span>);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">desc</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;普通热菜&quot;</span>;<br>    &#125;<br>&#125;<br><br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CocaCola</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Matter</span> &#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">scene</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;饮料&quot;</span>;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">brand</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;可口可乐&quot;</span>;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> BigDecimal <span class="hljs-title function_">price</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> BigDecimal.valueOf(<span class="hljs-number">3</span>);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">desc</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;可口可乐中瓶&quot;</span>;<br>    &#125;<br>&#125;<br><br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">PepsiCola</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Matter</span> &#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">scene</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;饮料&quot;</span>;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">brand</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;百事可乐&quot;</span>;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> BigDecimal <span class="hljs-title function_">price</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> BigDecimal.valueOf(<span class="hljs-number">3</span>);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">desc</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;百事可乐中瓶&quot;</span>;<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">IMenu</span> &#123;<br><br>    IMenu <span class="hljs-title function_">appendBeverage</span><span class="hljs-params">(Matter beverage)</span>;<br><br><br><br>    IMenu <span class="hljs-title function_">appendDishes</span><span class="hljs-params">(Matter dishes)</span>;<br><br><br>    IMenu <span class="hljs-title function_">appendStapleFood</span><span class="hljs-params">(Matter stapleFood)</span>;<br><br><br>    String <span class="hljs-title function_">ofDetail</span><span class="hljs-params">()</span>;<br><br>&#125;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Pack</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">IMenu</span> &#123;<br><br><br>    <span class="hljs-keyword">private</span> List&lt;Matter&gt; lists = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-type">BigDecimal</span> <span class="hljs-variable">price</span> <span class="hljs-operator">=</span> BigDecimal.ZERO;<br><br><br>    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> <span class="hljs-variable">copies</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Pack</span><span class="hljs-params">(<span class="hljs-type">int</span> copies)</span> &#123;<br>        <span class="hljs-built_in">this</span>.copies = copies;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Pack</span><span class="hljs-params">()</span> &#123;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> IMenu <span class="hljs-title function_">appendBeverage</span><span class="hljs-params">(Matter beverage)</span> &#123;<br>        lists.add(beverage);<br>        price = price.add(beverage.price());<br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> IMenu <span class="hljs-title function_">appendDishes</span><span class="hljs-params">(Matter dishes)</span> &#123;<br>        lists.add(dishes);<br>        price = price.add(dishes.price());<br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> IMenu <span class="hljs-title function_">appendStapleFood</span><span class="hljs-params">(Matter stapleFood)</span> &#123;<br>        lists.add(stapleFood);<br>        price = price.add(stapleFood.price());<br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">ofDetail</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-type">StringJoiner</span> <span class="hljs-variable">sj</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">StringJoiner</span>(<span class="hljs-string">&quot;[&quot;</span>, <span class="hljs-string">&quot; &quot;</span>, <span class="hljs-string">&quot;]&quot;</span>);<br>        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> e : lists) sj.add(e.desc());<br>        sj.add(<span class="hljs-string">&quot;price&quot;</span>).add(String.valueOf(price.doubleValue() * copies));<br>        <span class="hljs-keyword">return</span> sj.toString();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Builder</span> &#123;<br><br><br><br><br><br><br>    <span class="hljs-keyword">public</span> IMenu <span class="hljs-title function_">levelOne</span><span class="hljs-params">(<span class="hljs-type">int</span> copies)</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Pack</span>(copies)<br>                .appendBeverage(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Rice</span>())<br>                .appendDishes(<span class="hljs-keyword">new</span> <span class="hljs-title class_">HotDish</span>())<br>                .appendStapleFood(<span class="hljs-keyword">new</span> <span class="hljs-title class_">CocaCola</span>());<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> IMenu <span class="hljs-title function_">levelOne</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Pack</span>()<br>                .appendBeverage(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Rice</span>())<br>                .appendDishes(<span class="hljs-keyword">new</span> <span class="hljs-title class_">HotDish</span>())<br>                .appendStapleFood(<span class="hljs-keyword">new</span> <span class="hljs-title class_">CocaCola</span>());<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> IMenu <span class="hljs-title function_">levelTwo</span><span class="hljs-params">(<span class="hljs-type">int</span> copies)</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Pack</span>(copies)<br>                .appendBeverage(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Noodles</span>())<br>                .appendDishes(<span class="hljs-keyword">new</span> <span class="hljs-title class_">ColdDish</span>())<br>                .appendStapleFood(<span class="hljs-keyword">new</span> <span class="hljs-title class_">PepsiCola</span>());<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> IMenu <span class="hljs-title function_">levelTwo</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Pack</span>()<br>                .appendBeverage(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Noodles</span>())<br>                .appendDishes(<span class="hljs-keyword">new</span> <span class="hljs-title class_">ColdDish</span>())<br>                .appendStapleFood(<span class="hljs-keyword">new</span> <span class="hljs-title class_">PepsiCola</span>());<br>    &#125;<br><br>&#125;<br><br></code></pre></td></tr></table></figure>
<p>总结: 建造者模式适合于通过一些<code>不变</code>的小对象<code>组合</code>成不同种类的大对象的需求，建造者模式的最大优点就是易于扩展，在需要扩展时只需要添加少量代码，而不需要修改原先的代码。</p>
<h3 id="原型模式">原型模式</h3>
<blockquote>
<p>原型模式用于(重复)对象的创建，往往基于Java的clone实现，在此谈谈Java的克隆</p>
</blockquote>
<p>目录</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java">─normal<br>        E1.java<br>        E2.java<br>        E3.java<br>        Immutable.java<br>        R.java<br></code></pre></td></tr></table></figure>
<p>原型模式主要是用于解决对象的克隆，通常不常用，在此介绍Java如何克隆一个对象。</p>
<p>浅拷贝：对于基本类型而言，复制了一个新的值，对于引用类型而言，复制了地址。</p>
<p>深拷贝：对于任意类型而言都实现了完全复制。</p>
<p>Java实现深拷贝的方式有两种，一种是利用JDK自带的Clone实现，另一种是让对象经过两次IO。</p>
<p>基于Clone实现，首先确保要实现<code>Cloneable</code>接口，重写clone方法，值得注意的是<code>clone</code>方法是<code>Object</code>类中的本地方法，对于包含引用类型的对象而言需要层层克隆，并且这些引用类都需要实现<code>Cloneable</code>接口显然对于一个对象内层层包含多个引用对象时这种方式是不可取的，但是它的效率并不低。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//  引用类型R类</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">R</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Cloneable</span>, Serializable &#123;<br><br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">protected</span> R <span class="hljs-title function_">clone</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> CloneNotSupportedException &#123;<br>        <span class="hljs-keyword">return</span> (R) <span class="hljs-built_in">super</span>.clone();<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//  基于JDK的clone实现深拷贝</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">E1</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Cloneable</span>&#123;<br><br>    <span class="hljs-keyword">public</span> String name;<br>    R obj;<br><br>    <span class="hljs-type">int</span> v;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">E1</span><span class="hljs-params">(R _obj, String _name, <span class="hljs-type">int</span> _v)</span> &#123;<br>        <span class="hljs-built_in">this</span>.name = _name;<br>        <span class="hljs-built_in">this</span>.v = _v;<br>        <span class="hljs-built_in">this</span>.obj = _obj;<br>    &#125;<br><br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> E1 <span class="hljs-title function_">clone</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> CloneNotSupportedException &#123;<br>        <span class="hljs-type">E1</span> <span class="hljs-variable">ret</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;<br>        ret = (E1) <span class="hljs-built_in">super</span>.clone();<br>        ret.obj = ret.obj.clone();<br>        <span class="hljs-keyword">return</span> ret;<br>    &#125;<br><br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">toString</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;E&#123;&quot;</span> +<br>                <span class="hljs-string">&quot;name=&#x27;&quot;</span> + name + <span class="hljs-string">&#x27;\&#x27;&#x27;</span> +<br>                <span class="hljs-string">&quot;, obj=&quot;</span> + obj +<br>                <span class="hljs-string">&quot;, v=&quot;</span> + v +<br>                <span class="hljs-string">&#x27;&#125;&#x27;</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<p>另一种方式就是基于先读后写的方式，这种只需要保证所有的实现<code>Serializable</code>接口即可，然后将对象进行两次序列化即可。这样复制出来的对象比上面复制出的更’干净’。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">E2</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Serializable</span> &#123;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> R obj;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> String name;<br><br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> k;<br><br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">E2</span><span class="hljs-params">(R _obj, String _name, <span class="hljs-type">int</span> _k)</span> &#123;<br>        <span class="hljs-built_in">this</span>.obj = _obj;<br>        <span class="hljs-built_in">this</span>.name = _name;<br>        <span class="hljs-built_in">this</span>.k = _k;<br>    &#125;<br><br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">toString</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;E2&#123;&quot;</span> +<br>                <span class="hljs-string">&quot;obj=&quot;</span> + obj +<br>                <span class="hljs-string">&quot;, name=&#x27;&quot;</span> + name + <span class="hljs-string">&#x27;\&#x27;&#x27;</span> +<br>                <span class="hljs-string">&quot;, k=&quot;</span> + k +<br>                <span class="hljs-string">&#x27;&#125;&#x27;</span>;<br>    &#125;<br><br><br>    <span class="hljs-keyword">public</span> E2 <span class="hljs-title function_">cloneBySerializable</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> IOException, ClassNotFoundException &#123;<br>        <span class="hljs-keyword">try</span> (<br>                <span class="hljs-type">var</span> <span class="hljs-variable">buf</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ByteArrayOutputStream</span>();<br>                <span class="hljs-type">var</span> <span class="hljs-variable">oos</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectOutputStream</span>(buf)<br>        ) &#123;<br>            oos.writeObject(<span class="hljs-built_in">this</span>);<br>            <span class="hljs-keyword">try</span> (<br>                    <span class="hljs-type">var</span> <span class="hljs-variable">in</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectInputStream</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">ByteArrayInputStream</span>(buf.toByteArray()))<br>                    ) &#123;<br>                <span class="hljs-keyword">return</span> (E2) in.readObject();<br>            &#125;<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<p>至于我为什么说更’干净’呢?这就得提起<code>E1</code>和<code>E2</code>中都有的<code>String</code>了，<code>String</code>作为JDK自带的类，并没有实现<code>Cloneable</code>接口，那么它在深拷贝的时候，原对象和复制后的对象的<code>String</code>对象应该是同一个，事实证明确实如此，但这不就违背了深拷贝的定义了吗?但是<code>String</code>它是一个特殊的类，被成为<code>不可变类</code>，不可变类就是一个类创建对象后这个对象中的属性值不在发生改变，当需要改变时都需要返回新的对象，这样想的话，不可变类的特性似乎刚好满足我们对对象复制的要求。而且还省事，所以有必要时可以考虑将类设为不可变类，但是不可变类会反复创建对象，也是有偿有失。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Test</span> &#123;<br><br><br>    <span class="hljs-meta">@org</span>.junit.Test<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">test0</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> CloneNotSupportedException &#123;<br>        <span class="hljs-type">E1</span> <span class="hljs-variable">e</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">E1</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">R</span>(), <span class="hljs-string">&quot;huya&quot;</span>, <span class="hljs-number">123</span>);<br>        <span class="hljs-type">long</span> <span class="hljs-variable">t1</span> <span class="hljs-operator">=</span> System.currentTimeMillis();<br>        <span class="hljs-type">E1</span> <span class="hljs-variable">clone</span> <span class="hljs-operator">=</span> e.clone();<br>        <span class="hljs-type">long</span> <span class="hljs-variable">t2</span> <span class="hljs-operator">=</span> System.currentTimeMillis();<br>        System.out.println(t2 - t1);  <span class="hljs-comment">//时间性能优越</span><br>        System.out.println(e);<br>        System.out.println(clone);<br>        System.out.println(e.name == clone.name); <span class="hljs-comment">//输出true</span><br><br>    &#125;<br><br>    <span class="hljs-meta">@org</span>.junit.Test<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">test1</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> IOException, ClassNotFoundException &#123;<br>        <span class="hljs-type">E2</span> <span class="hljs-variable">e</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">E2</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">R</span>(), <span class="hljs-string">&quot;huya&quot;</span>, <span class="hljs-number">123</span>);<br>        <span class="hljs-type">long</span> <span class="hljs-variable">t1</span> <span class="hljs-operator">=</span> System.currentTimeMillis();<br>        <span class="hljs-type">E2</span> <span class="hljs-variable">clone</span> <span class="hljs-operator">=</span> e.cloneBySerializable();<br>        <span class="hljs-type">long</span> <span class="hljs-variable">t2</span> <span class="hljs-operator">=</span> System.currentTimeMillis();<br>        System.out.println(t2 - t1);<br>        System.out.println(e);<br>        System.out.println(clone);<br>        System.out.println(e.name == clone.name); <span class="hljs-comment">//输出false</span><br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure>
<h3 id="单例模式">单例模式</h3>
<p>单例模式主要是用于解决对象的复用性，有饿汉和懒汉模式，主要就是一下7种</p>
<p>目录</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java">type<br>    ├─hungry<br>    │      <span class="hljs-keyword">package</span>-info.java<br>    │      S1.java<br>    │      <br>    └─lazy<br>            <span class="hljs-keyword">package</span>-info.java<br>            S2.java<br>            S3.java<br>            S4.java<br>            S5.java<br>            S6.java<br>            S7.java<br></code></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment">* 饿汉,线程安全, 此种类型也可以不要获取实例方法</span><br><span class="hljs-comment">*/</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">S1</span> &#123;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">S1</span> <span class="hljs-variable">INSTANCE</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">S1</span>();<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> S1 <span class="hljs-title function_">getInstance</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> INSTANCE;<br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 懒汉式线程不安全</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">S2</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">volatile</span> S2 s2;<br><br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> S2 <span class="hljs-title function_">getInstance</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">if</span> (s2 == <span class="hljs-literal">null</span>) s2 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">S2</span>();<br>        <span class="hljs-keyword">return</span> s2;<br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 线程安全，但效率太低</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">S3</span> &#123;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> S3 s3;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">synchronized</span> <span class="hljs-keyword">static</span> S3 <span class="hljs-title function_">getInstance</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">if</span> (s3 == <span class="hljs-literal">null</span>) s3 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">S3</span>();<br>        <span class="hljs-keyword">return</span> s3;<br>    &#125;<br><br>&#125;<br><br></code></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 效率较高且安全的懒汉式</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">S4</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">volatile</span> S4 s4;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> S4 <span class="hljs-title function_">getInstance</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">if</span> (s4 != <span class="hljs-literal">null</span>) <span class="hljs-keyword">return</span> s4;<br>        <span class="hljs-keyword">synchronized</span> (S4.class) &#123;<br>            <span class="hljs-keyword">if</span> (s4 != <span class="hljs-literal">null</span>) &#123;<br>                s4 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">S4</span>();<br>            &#125;<br>        &#125;<br>        <span class="hljs-keyword">return</span> s4;<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 线程安全，无锁，懒汉,比较推荐</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">S5</span> &#123;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">S5Holder</span> &#123;<br>        <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">S5</span> <span class="hljs-variable">s5</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">S5</span>();<br>    &#125;<br><br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> S5 <span class="hljs-title function_">getInstance</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> S5Holder.s5;<br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 懒汉，使用Atomic,乐观锁</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">S6</span> &#123;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> AtomicReference&lt;S6&gt; INSTANCE = <span class="hljs-keyword">new</span> <span class="hljs-title class_">AtomicReference</span>&lt;&gt;();<br><br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> S6 <span class="hljs-title function_">getInstance</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-type">S6</span> <span class="hljs-variable">s6</span> <span class="hljs-operator">=</span> INSTANCE.get();<br>        <span class="hljs-keyword">if</span> (s6 != <span class="hljs-literal">null</span>) <span class="hljs-keyword">return</span> s6;<br>        INSTANCE.compareAndSet(<span class="hljs-literal">null</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">S6</span>());<br>        <span class="hljs-keyword">return</span> INSTANCE.get();<br>    &#125;<br><br><br>&#125;<br></code></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 简洁高效,但用处不多，无法实现继承</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">enum</span> <span class="hljs-title class_">S7</span> &#123;<br><br><br>    S_7;<br><br>    <span class="hljs-keyword">public</span> S7 <span class="hljs-title function_">getInstance</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> S_7;<br>    &#125;<br><br>&#125;<br><br></code></pre></td></tr></table></figure>
<p>单例模式根据情况选取合适的即可，这几种单例，在功能上的实现都是一致的。</p>
<h3 id="适配器模式">适配器模式</h3>
<p>适配器模式，显然易见就是为了适配某种东西的，例如电源适配器，将220V的电压适配到电子设备适合的电压，适配器模式的使用范围还是非常广的，在很多地方都能看见，在之前的设计模式中也有体现。通常都是将方法签名或方法参数进行适配。</p>
<p>目录</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs java">├─action<br>│  │  Ac1.java<br>│  │  Ac2.java<br>│  │  IAdapter.java<br>│  │  <span class="hljs-keyword">package</span>-info.java<br>│  │<br>│  └─impl<br>│          Ac1Impl.java<br>│          Ac2Impl.java<br>│<br>└─parameter<br>    │  <span class="hljs-keyword">package</span>-info.java<br>    │  ParameterAdapter.java<br>    │<br>    └─e<br>            M.java<br>            M1.java<br>            M2.java<br></code></pre></td></tr></table></figure>
<p>在进行方法签名的适配时，采用将字段进行一一对应，并将初始对象进行序列化，最后在进行反序列化的到参数即可。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">M</span> &#123;<br><br><br>    String userId;<br><br>    String orderId;<br><br><br>    Date date;<br><br><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getUserId</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> userId;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setUserId</span><span class="hljs-params">(String userId)</span> &#123;<br>        <span class="hljs-built_in">this</span>.userId = userId;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getOrderId</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> orderId;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setOrderId</span><span class="hljs-params">(String orderId)</span> &#123;<br>        <span class="hljs-built_in">this</span>.orderId = orderId;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> Date <span class="hljs-title function_">getDate</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> date;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setDate</span><span class="hljs-params">(String dateStr)</span> <span class="hljs-keyword">throws</span> ParseException &#123;<br>        <span class="hljs-type">SimpleDateFormat</span> <span class="hljs-variable">dateFormat</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SimpleDateFormat</span>(<span class="hljs-string">&quot;yyyy-MM-dd HH:mm:ss.SSS&quot;</span>, Locale.ENGLISH);<br>        <span class="hljs-built_in">this</span>.date = dateFormat.parse(dateStr);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">toString</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;M&#123;&quot;</span> +<br>                <span class="hljs-string">&quot;userId=&#x27;&quot;</span> + userId + <span class="hljs-string">&#x27;\&#x27;&#x27;</span> +<br>                <span class="hljs-string">&quot;, orderId=&#x27;&quot;</span> + orderId + <span class="hljs-string">&#x27;\&#x27;&#x27;</span> +<br>                <span class="hljs-string">&quot;, date=&quot;</span> + date +<br>                <span class="hljs-string">&#x27;&#125;&#x27;</span>;<br>    &#125;<br>&#125;<br><br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">record</span> <span class="hljs-title class_">M1</span><span class="hljs-params">(</span><br><span class="hljs-params"></span><br><span class="hljs-params">        String orderId,</span><br><span class="hljs-params"></span><br><span class="hljs-params"></span><br><span class="hljs-params">        String uid,</span><br><span class="hljs-params"></span><br><span class="hljs-params"></span><br><span class="hljs-params">        LocalDateTime date</span><br><span class="hljs-params"></span><br><span class="hljs-params">)</span> &#123;<br><br>&#125;<br><br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">record</span> <span class="hljs-title class_">M2</span><span class="hljs-params">(</span><br><span class="hljs-params">        String skuId,</span><br><span class="hljs-params"></span><br><span class="hljs-params"></span><br><span class="hljs-params">        String userId,</span><br><span class="hljs-params"></span><br><span class="hljs-params"></span><br><span class="hljs-params">        Date date</span><br><span class="hljs-params">)</span> &#123;<br><br><br>&#125;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ParameterAdapter</span> &#123;<br><br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> M <span class="hljs-title function_">adapter</span><span class="hljs-params">(String jsonStr, Map&lt;String, String&gt; keyValue)</span> <span class="hljs-keyword">throws</span> InvocationTargetException, NoSuchMethodException, IllegalAccessException &#123;<br>        Map&lt;?, ?&gt; map = JSON.parseObject(jsonStr, Map.class);<br>        <span class="hljs-keyword">return</span> adapter(map, keyValue);<br>    &#125;<br><br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> M <span class="hljs-title function_">adapter</span><span class="hljs-params">(Map&lt;?, ?&gt; obj, Map&lt;String, String&gt; keyValue)</span> <span class="hljs-keyword">throws</span> NoSuchMethodException, InvocationTargetException, IllegalAccessException &#123;<br>        <span class="hljs-type">M</span> <span class="hljs-variable">m</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">M</span>();<br>        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> e : keyValue.entrySet()) &#123;<br>            <span class="hljs-type">var</span> <span class="hljs-variable">val</span> <span class="hljs-operator">=</span> obj.get(e.getKey());<br>            <span class="hljs-type">String</span> <span class="hljs-variable">value</span> <span class="hljs-operator">=</span> e.getValue();<br>            <span class="hljs-type">String</span> <span class="hljs-variable">methodName</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;set&quot;</span> + value.substring(<span class="hljs-number">0</span>, <span class="hljs-number">1</span>).toUpperCase() + value.substring(<span class="hljs-number">1</span>);<br>            M.class.getMethod(methodName, String.class).invoke(m, val.toString());<br>        &#125;<br>        <span class="hljs-keyword">return</span> m;<br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure>
<p>在进行行为适配时，采用中间加一个接口的方式，使得不同的实现有同一个接口。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Ac1</span> &#123;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">helloMethod</span><span class="hljs-params">(String hello, String world)</span> &#123;<br>        System.out.println(hello + <span class="hljs-string">&quot; &quot;</span> + world);<br>    &#125;<br><br>&#125;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Ac2</span> &#123;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">methodHello</span><span class="hljs-params">(String hello, String world)</span> &#123;<br>        System.out.println(world + <span class="hljs-string">&quot; &quot;</span> + hello);<br>    &#125;<br><br>&#125;<br><br></code></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">IAdapter</span> &#123;<br><br><br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">hello</span><span class="hljs-params">(String hello, String world)</span>;<br><br>&#125;<br><br></code></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Ac1Impl</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">IAdapter</span> &#123;<br><br>    <span class="hljs-type">Ac1</span> <span class="hljs-variable">ac1</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Ac1</span>();<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">hello</span><span class="hljs-params">(String hello, String world)</span> &#123;<br>        ac1.helloMethod(hello, world);<br>    &#125;<br>&#125;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Ac2Impl</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">IAdapter</span> &#123;<br><br>    <span class="hljs-type">Ac2</span> <span class="hljs-variable">ac2</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Ac2</span>();<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">hello</span><span class="hljs-params">(String hello, String world)</span> &#123;<br>        ac2.methodHello(hello, world);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<h3 id="桥接模式">桥接模式</h3>
<p>当我们需要将多种功能进行组合或者笛卡尔积时，使用桥接模式是一种不错的选择，例如将微信支付和支付宝支付，加上指纹、面容支付时，此处使用桥接模式实现。</p>
<p>目录</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java">F:.<br>└─pay<br>    │  IPayMode.java<br>    │  Pay.java<br>    │  WxPay.java<br>    │  ZfbPay.java<br>    │  <br>    └─impl<br>            CyPayMode.java<br>            FacePayMode.java<br>            FingerPayMode.java<br><br></code></pre></td></tr></table></figure>
<p>使用<code>PayMode</code>接口来定义多种校验方式</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">IPayMode</span> &#123;<br><br><br>    <span class="hljs-type">boolean</span> <span class="hljs-title function_">checkSecurity</span><span class="hljs-params">(String uid)</span>;<br><br>&#125;<br><br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CyPayMode</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">IPayMode</span> &#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">checkSecurity</span><span class="hljs-params">(String uid)</span> &#123;<br>        <span class="hljs-comment">//  业务逻辑</span><br>        System.out.println(<span class="hljs-string">&quot;密码校验&quot;</span>);<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>    &#125;<br>&#125;<br><br><br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">FacePayMode</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">IPayMode</span> &#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">checkSecurity</span><span class="hljs-params">(String uid)</span> &#123;<br>        <span class="hljs-comment">//业务逻辑</span><br>        System.out.println(<span class="hljs-string">&quot;面容校验&quot;</span>);<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>    &#125;<br>&#125;<br><br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">FingerPayMode</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">IPayMode</span> &#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">checkSecurity</span><span class="hljs-params">(String uid)</span> &#123;<br>        <span class="hljs-comment">//业务逻辑</span><br>        System.out.println(<span class="hljs-string">&quot;指纹校验&quot;</span>);<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<p>定义<code>Pay</code>抽象类，并定义<code>PayMode</code>成员变量，在其基类进行创建时就指定好<code>PayMode</code>。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Pay</span> &#123;<br><br>    <span class="hljs-keyword">protected</span> <span class="hljs-type">Logger</span> <span class="hljs-variable">logger</span> <span class="hljs-operator">=</span> LoggerFactory.getLogger(Pay.class);<br>    <span class="hljs-keyword">protected</span> IPayMode payMode;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Pay</span><span class="hljs-params">(IPayMode payMode)</span> &#123;<br>        <span class="hljs-built_in">this</span>.payMode = payMode;<br>    &#125;<br><br>    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">abstract</span> String <span class="hljs-title function_">trade</span><span class="hljs-params">(String uid, String tradeId, BigDecimal amount)</span>;<br><br>&#125;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">WxPay</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Pay</span>&#123;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">WxPay</span><span class="hljs-params">(IPayMode payMode)</span> &#123;<br>        <span class="hljs-built_in">super</span>(payMode);<br>    &#125;<br><br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">trade</span><span class="hljs-params">(String uid, String tradeId, BigDecimal amount)</span> &#123;<br><br>        logger.info(<span class="hljs-string">&quot;模拟微信渠道支付划账开始。uId：&#123;&#125; tradeId：&#123;&#125; amount：&#123;&#125;&quot;</span>, uid, tradeId, amount);<br>        <span class="hljs-type">boolean</span> <span class="hljs-variable">isSecurity</span> <span class="hljs-operator">=</span> <span class="hljs-built_in">this</span>.payMode.checkSecurity(uid);<br>        logger.info(<span class="hljs-string">&quot;校验成功， 成功支付&quot;</span>);<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;0x00000000000&quot;</span>;<br>    &#125;<br>&#125;<br><br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ZfbPay</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Pay</span>&#123;<br><br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">ZfbPay</span><span class="hljs-params">(IPayMode payMode)</span> &#123;<br>        <span class="hljs-built_in">super</span>(payMode);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">trade</span><span class="hljs-params">(String uid, String tradeId, BigDecimal amount)</span> &#123;<br>        logger.info(<span class="hljs-string">&quot;模拟支付宝渠道支付划账开始。uId：&#123;&#125; tradeId：&#123;&#125; amount：&#123;&#125;&quot;</span>, uid, tradeId, amount);<br>        <span class="hljs-type">boolean</span> <span class="hljs-variable">isSecurity</span> <span class="hljs-operator">=</span> <span class="hljs-built_in">this</span>.payMode.checkSecurity(uid);<br>        logger.info(<span class="hljs-string">&quot;校验成功， 成功支付&quot;</span>);<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;0x00000000000&quot;</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<p>桥接模式可以很方便的实现多种模式之间的组合，使用桥接模式满足开闭原则和单一职责原则。</p>
<h3 id="组合模式">组合模式</h3>
<p>实现决策树来体现组合模式，在对特定人群进行量化时，可以采取决策树来进行筛选、决策。</p>
<p>实现树的创建，分别是<code>TreeRoot</code>、<code>TreeNode</code>、<code>TreeLink</code>，分别代表树根、节点、树链，树根本身就是一个树节点，树节点又分为普通节点和叶子节点，普通节点上没有值，只有叶子节点上有，节点之间通过树链进行连接，节点上存有限制类型，链上存有比较类型，和比较值，通过这样构成一颗决策树，来将不同用户筛选进不同值。</p>
<p>目录</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs java">│  Strategy.java<br>│<br>├─aggregation<br>│      TreeRich.java<br>│<br>├─engine<br>│  │  BaseEngine.java<br>│  │  Engine.java<br>│  │  EngineConfig.java<br>│  │<br>│  └─impl<br>│          TreeEngine.java<br>│<br>├─logic<br>│  │  BaseFilter.java<br>│  │  Filter.java<br>│  │<br>│  └─impl<br>│          UserAgeFilter.java<br>│          UserGenderFilter.java<br>│<br>├─res<br>│      R.java<br>│<br>└─tree<br>        TreeLink.java<br>        TreeNode.java<br>        TreeRoot.java<br>        TreeType.java<br><br></code></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//tree的构建</span><br><span class="hljs-meta">@Data</span><br><span class="hljs-meta">@AllArgsConstructor</span><br><span class="hljs-meta">@NoArgsConstructor</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TreeRoot</span> &#123;<br><br>    String treeId;<br><br><br>    String desc;<br><br><br>    String treeName;<br><br>    String treeRootId;<br><br>&#125;<br><br><span class="hljs-meta">@Data</span><br><span class="hljs-meta">@AllArgsConstructor</span><br><span class="hljs-meta">@NoArgsConstructor</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TreeNode</span> &#123;<br><br><br>    String rootId;<br><br>    String treeId;<br><br><br>    TreeType treeType;<br><br><br>    String val;<br><br>    List&lt;TreeLink&gt; links;<br><br>    Strategy strategy;<br><br>&#125;<br><br><span class="hljs-meta">@Data</span><br><span class="hljs-meta">@AllArgsConstructor</span><br><span class="hljs-meta">@NoArgsConstructor</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TreeLink</span> &#123;<br><br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">enum</span> <span class="hljs-title class_">StrategyType</span> &#123;<br>        EQ,<br><br>        GT,<br><br>        LT<br>    &#125;<br><br>    String treeRootId;<br><br><br>    String fromTreeId;<br><br><br>    String toTreeId;<br><br>    String limitVal;<br><br>    StrategyType strategyType;<br><br>&#125;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">enum</span> <span class="hljs-title class_">TreeType</span> &#123;<br><br>    NORMAL,<br><br>    LEAF<br><br>&#125;<br><br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">enum</span> <span class="hljs-title class_">Strategy</span> &#123;<br><br><br>    AGE,<br><br>    GENDER<br><br>&#125;<br></code></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//入参组合</span><br><span class="hljs-meta">@Data</span><br><span class="hljs-meta">@NoArgsConstructor</span><br><span class="hljs-meta">@AllArgsConstructor</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TreeRich</span> &#123;<br><br><br>    <span class="hljs-meta">@Data</span><br>    <span class="hljs-meta">@NoArgsConstructor</span><br>    <span class="hljs-meta">@AllArgsConstructor</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">User</span> &#123;<br>        String userId;<br><br>        String userName;<br><br>        String age;<br><br>        String gender;<br>    &#125;<br><br>    TreeRoot root;<br><br><br>    Map&lt;String, TreeNode&gt; map;<br><br>    User user;<br><br>&#125;<br><br><span class="hljs-comment">//出参</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">record</span> <span class="hljs-title class_">R</span><span class="hljs-params">(</span><br><span class="hljs-params">        String userId,</span><br><span class="hljs-params">        String val</span><br><span class="hljs-params">)</span> &#123;<br><br><br>&#125;<br></code></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//Filter实现</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">Filter</span> &#123;<br><br><br>    String <span class="hljs-title function_">filter</span><span class="hljs-params">(String realVal, List&lt;TreeLink&gt; links)</span>;<br><br><br><br>    <span class="hljs-type">boolean</span> <span class="hljs-title function_">judge</span><span class="hljs-params">(String realVal, TreeLink.StrategyType strategyType, String limitVal)</span>;<br><br>&#125;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">BaseFilter</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Filter</span> &#123;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">filter</span><span class="hljs-params">(String realVal, List&lt;TreeLink&gt; links)</span> &#123;<br>        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> link : links) &#123;<br>            <span class="hljs-keyword">if</span> (judge(realVal, link.getStrategyType(), link.getLimitVal())) <span class="hljs-keyword">return</span> link.getToTreeId();<br>        &#125;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;-1&quot;</span>;<br>    &#125;<br><br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> String <span class="hljs-title function_">getRealVal</span><span class="hljs-params">(TreeRich.User user)</span>;<br><br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">judge</span><span class="hljs-params">(String realVal, TreeLink.StrategyType strategyType, String limitVal)</span> &#123;<br>        <span class="hljs-keyword">switch</span> (strategyType) &#123;<br>            <span class="hljs-keyword">case</span> EQ -&gt; &#123;<br>                <span class="hljs-keyword">return</span> realVal.equals(limitVal);<br>            &#125;<br>            <span class="hljs-keyword">case</span> GT -&gt; &#123;<br>                <span class="hljs-keyword">return</span> Double.parseDouble(realVal) &gt;= Double.parseDouble(limitVal);<br>            &#125;<br>            <span class="hljs-keyword">case</span> LT -&gt; &#123;<br>                <span class="hljs-keyword">return</span> Double.parseDouble(realVal) &lt;= Double.parseDouble(limitVal);<br>            &#125;<br>            <span class="hljs-keyword">default</span> -&gt; &#123;<br>                <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>            &#125;<br>        &#125;<br>    &#125;<br>&#125;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserAgeFilter</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">BaseFilter</span> &#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getRealVal</span><span class="hljs-params">(TreeRich.User user)</span> &#123;<br>        <span class="hljs-keyword">return</span> user.getAge();<br>    &#125;<br>&#125;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserGenderFilter</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">BaseFilter</span> &#123;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getRealVal</span><span class="hljs-params">(TreeRich.User user)</span> &#123;<br>        <span class="hljs-keyword">return</span> user.getGender();<br>    &#125;<br>&#125;<br><br><br></code></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//engine实现</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">Engine</span> &#123;<br><br><br>    R <span class="hljs-title function_">process</span><span class="hljs-params">(TreeRich treeRich)</span>;<br><br>&#125;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">EngineConfig</span> &#123;<br><br>    <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> ConcurrentHashMap&lt;Strategy, BaseFilter&gt; map = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ConcurrentHashMap</span>&lt;&gt;();<br><br><br><br>    <span class="hljs-keyword">static</span> &#123;<br>        map.put(Strategy.AGE, <span class="hljs-keyword">new</span> <span class="hljs-title class_">UserAgeFilter</span>());<br>        map.put(Strategy.GENDER, <span class="hljs-keyword">new</span> <span class="hljs-title class_">UserGenderFilter</span>());<br>    &#125;<br><br><br>&#125;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">BaseEngine</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">EngineConfig</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Engine</span> &#123;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">Logger</span> <span class="hljs-variable">logger</span> <span class="hljs-operator">=</span> LoggerFactory.getLogger(BaseEngine.class);<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> R <span class="hljs-title function_">process</span><span class="hljs-params">(TreeRich treeRich)</span>;<br><br><br>    <span class="hljs-keyword">public</span> TreeNode <span class="hljs-title function_">doProcess</span><span class="hljs-params">(TreeRich treeRich)</span> &#123;<br>        <span class="hljs-type">TreeRoot</span> <span class="hljs-variable">root</span> <span class="hljs-operator">=</span> treeRich.getRoot();<br>        TreeRich.<span class="hljs-type">User</span> <span class="hljs-variable">user</span> <span class="hljs-operator">=</span> treeRich.getUser();<br>        Map&lt;String, TreeNode&gt; treeNodeMap = treeRich.getMap();<br>        <span class="hljs-type">TreeNode</span> <span class="hljs-variable">node</span> <span class="hljs-operator">=</span> treeNodeMap.get(root.getTreeId());<br>        <span class="hljs-keyword">while</span> (node.getTreeType().equals(TreeType.NORMAL)) &#123;<br>            logger.info(<span class="hljs-string">&quot;决策到节点&#123;&#125;&quot;</span>, node);<br>            <span class="hljs-type">BaseFilter</span> <span class="hljs-variable">filter</span> <span class="hljs-operator">=</span> map.get(node.getStrategy());<br>            <span class="hljs-type">String</span> <span class="hljs-variable">realVal</span> <span class="hljs-operator">=</span> filter.getRealVal(user);<br>            <span class="hljs-type">String</span> <span class="hljs-variable">nextTreeId</span> <span class="hljs-operator">=</span> filter.filter(realVal, node.getLinks());<br>            <span class="hljs-keyword">if</span> (<span class="hljs-string">&quot;-1&quot;</span>.equals(nextTreeId)) <span class="hljs-keyword">break</span>;<br>            node = treeNodeMap.get(nextTreeId);<br>        &#125;<br>        <span class="hljs-keyword">return</span> node;<br>    &#125;<br><br>&#125;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TreeEngine</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">BaseEngine</span> &#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> R <span class="hljs-title function_">process</span><span class="hljs-params">(TreeRich treeRich)</span> &#123;<br>        <span class="hljs-type">TreeNode</span> <span class="hljs-variable">treeNode</span> <span class="hljs-operator">=</span> <span class="hljs-built_in">this</span>.doProcess(treeRich);<br>        <span class="hljs-keyword">if</span> (treeNode.getTreeType() != TreeType.LEAF) <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">R</span>(treeRich.getUser().getUserId(), <span class="hljs-string">&quot;未能匹配结果&quot;</span>);<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">R</span>(treeRich.getUser().getUserId(), treeNode.getVal());<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<p>决策树的实现可以将复杂的判断交给内部进行实现，外部调用时依然是比较方便，体现了开闭原则，当有新的决策时只需要更换一颗新的决策树即可，此决策树的实现数据库存储也可以这样实现。</p>
<h3 id="装饰器模式">装饰器模式</h3>
<p>装饰器模式主要是用于解决对某一个类进行补充或者增强，而非通过直接继承实现，通过创建一个抽象的装饰器类，即可非常简单的实现对类的扩充及其增强。这里以<code>SpringMVC</code>中的拦截器为例，对拦截器实现增强。</p>
<p>目录</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java">│  Main.java<br>│<br>└─controller<br>    │  MainConfig.java<br>    │  MainController.java<br>    │<br>    ├─decorator<br>    │      InterceptorDecorator.java<br>    │<br>    └─interceptor<br>            MainEnhanceInterceptor.java<br>            MainInterceptor.java<br><br></code></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//基类的拦截器</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MainInterceptor</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">HandlerInterceptor</span> &#123;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">preHandle</span><span class="hljs-params">(HttpServletRequest request, HttpServletResponse response, Object handler)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        <span class="hljs-keyword">return</span> request.getHeader(<span class="hljs-string">&quot;A&quot;</span>).equals(<span class="hljs-string">&quot;a&quot;</span>);<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//装饰器</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">InterceptorDecorator</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">HandlerInterceptor</span> &#123;<br><br>    <span class="hljs-keyword">protected</span> HandlerInterceptor handlerInterceptor; <span class="hljs-comment">//将其给构建进来</span><br><br>    <span class="hljs-keyword">protected</span> <span class="hljs-title function_">InterceptorDecorator</span><span class="hljs-params">(HandlerInterceptor handlerInterceptor)</span> &#123;<br>        <span class="hljs-built_in">this</span>.handlerInterceptor = handlerInterceptor;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">preHandle</span><span class="hljs-params">(HttpServletRequest request, HttpServletResponse response, Object handler)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>.handlerInterceptor.preHandle(request, response, handler);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//增强实现</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MainEnhanceInterceptor</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">InterceptorDecorator</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">MainEnhanceInterceptor</span><span class="hljs-params">(HandlerInterceptor handlerInterceptor)</span> &#123;<br>        <span class="hljs-built_in">super</span>(handlerInterceptor);<br>    &#125;<br><br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">preHandle</span><span class="hljs-params">(HttpServletRequest request, HttpServletResponse response, Object handler)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        <span class="hljs-type">boolean</span> <span class="hljs-variable">handle</span> <span class="hljs-operator">=</span> <span class="hljs-built_in">super</span>.preHandle(request, response, handler);<br>        <span class="hljs-keyword">if</span> (!handle) <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>        <span class="hljs-keyword">return</span> request.getHeader(<span class="hljs-string">&quot;B&quot;</span>).equals(<span class="hljs-string">&quot;b&quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<h3 id="门面模式">门面模式</h3>
<p>门面模式通常用于处理对外部提供统一的<code>api</code>之类，像<code>springboot</code>自定义<code>starter</code>就是一种门面模式的体现。</p>
<p>目录</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br></pre></td><td class="code"><pre><code class="hljs java">│  pom.xml<br>│  <br>├─app<br>│  │  pom.xml<br>│  │  <br>│  ├─src<br>│  │  ├─main<br>│  │  │  ├─java<br>│  │  │  │  └─app<br>│  │  │  │      │  Main.java<br>│  │  │  │      │  <br>│  │  │  │      ├─controller<br>│  │  │  │      │      MainController.java<br>│  │  │  │      │      <br>│  │  │  │      └─entity<br>│  │  │  │              Res.java<br>│  │  │  │              <br>│  │  │  └─resources<br>│  │  │          application.properties<br>│  │  │          <br>│  │  └─test<br>│  │      └─java<br>│  └─target<br>│      ├─classes<br>│      │  │  application.properties<br>│      │  │  <br>│      │  └─app<br>│      │      │  Main.class<br>│      │      │<br>│      │      ├─controller<br>│      │      │      MainController.class<br>│      │      │<br>│      │      └─entity<br>│      │              Res.class<br>│      │<br>│      └─generated-sources<br>│          └─annotations<br>└─share<br>    │  pom.xml<br>    │<br>    ├─src<br>    │  ├─main<br>    │  │  ├─java<br>    │  │  │  ├─annotation<br>    │  │  │  │      AInterceptor.java<br>    │  │  │  │<br>    │  │  │  ├─aop<br>    │  │  │  │      Asp.java<br>    │  │  │  │<br>    │  │  │  └─config<br>    │  │  │          Config.java<br>    │  │  │          ConfigProperties.java<br>    │  │  │          ConfigService.java<br>    │  │  │<br>    │  │  └─resources<br>    │  │      └─META-INF<br>    │  │          └─spring<br>    │  │                  org.springframework.boot.autoconfigure.AutoConfiguration.imports<br>    │  │<br>    │  └─test<br>    │      └─java<br>    └─target<br>        │  share-<span class="hljs-number">2.7</span><span class="hljs-number">.5</span>.jar<br>        │<br>        ├─classes<br>        │  ├─annotation<br>        │  │      AInterceptor.class<br>        │  │<br>        │  ├─aop<br>        │  │      Asp.class<br>        │  │<br>        │  ├─config<br>        │  │      Config.class<br>        │  │      ConfigProperties.class<br>        │  │      ConfigService.class<br>        │  │<br>        │  └─META-INF<br>        │      │  spring-configuration-metadata.json<br>        │      │<br>        │      └─spring<br>        │              org.springframework.boot.autoconfigure.AutoConfiguration.imports<br>        │<br>        ├─generated-sources<br>        │  └─annotations<br>        ├─generated-test-sources<br>        │  └─test-annotations<br>        ├─maven-archiver<br>        │      pom.properties<br>        │<br>        ├─maven-status<br>        │  └─maven-compiler-plugin<br>        │      ├─compile<br>        │      │  └─<span class="hljs-keyword">default</span>-compile<br>        │      │          createdFiles.lst<br>        │      │          inputFiles.lst<br>        │      │<br>        │      └─testCompile<br>        │          └─<span class="hljs-keyword">default</span>-testCompile<br>        │                  createdFiles.lst<br>        │                  inputFiles.lst<br>        │<br>        └─test-classes<br></code></pre></td></tr></table></figure>
<p>通过<code>springboot</code>自定义<code>share</code>starter(命名不规范)，内部通过<code>aop</code>实现参数验证,将包装好的工程交给<code>app</code>来测试。在自定义starter时需要注意将这个跳过。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java">&lt;plugins&gt;<br>            &lt;plugin&gt;<br>                &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;<br>                &lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt;<br>                &lt;configuration&gt;<br>                    &lt;skip&gt;<span class="hljs-literal">true</span>&lt;/skip&gt;<br>                &lt;/configuration&gt;<br>            &lt;/plugin&gt;<br>    &lt;/plugins&gt;<br></code></pre></td></tr></table></figure>
<p>代码细节就是<code>aop</code>的使用，均在项目中详细写出。</p>
<h3 id="享元模式">享元模式</h3>
<p>享元模式在平常的开发中还是很常遇见的，通常为了节约对象资源，将对象中不变的属性保存起来，每次只对对象变得部分进行更改，<code>redis</code>的使用就是享元模式的体现。</p>
<p>目录</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java">├─dy<br>│      RedisUtil.java<br>│<br>├─im<br>│      QueryFactory.java<br>│<br>└─re<br>        Shop.java<br></code></pre></td></tr></table></figure>
<p><code>QueryFactory</code>是来缓存对象中不变的属性，<code>RedisUtil</code>用于保存对象动态变化的部分，在查询时两者结合就可以查询出完整的对象，大大节约了内存消耗，以及时间消耗。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RedisUtil</span> &#123;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-type">ScheduledExecutorService</span> <span class="hljs-variable">executorService</span> <span class="hljs-operator">=</span> Executors.newScheduledThreadPool(<span class="hljs-number">1</span>);<br><br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-type">AtomicInteger</span> <span class="hljs-variable">stock</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">AtomicInteger</span>();<br><br>    <span class="hljs-keyword">static</span> &#123;<br>        executorService.scheduleAtFixedRate(() -&gt; &#123;<br>            stock.addAndGet(<span class="hljs-number">1</span>);<br>        &#125;, <span class="hljs-number">0</span>, <span class="hljs-number">100000</span>, TimeUnit.MICROSECONDS);<br>    &#125;<br><br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Integer <span class="hljs-title function_">getStock</span><span class="hljs-params">(Integer id)</span> &#123;<br>        <span class="hljs-keyword">return</span> stock.get();<br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">QueryFactory</span> &#123;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> ConcurrentHashMap&lt;Integer, Shop&gt; map = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ConcurrentHashMap</span>&lt;&gt;();<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Shop <span class="hljs-title function_">get</span><span class="hljs-params">(Integer id)</span> &#123;<br>        <span class="hljs-keyword">if</span> (map.containsKey(id)) <span class="hljs-keyword">return</span> map.get(id);<br>        <span class="hljs-type">Shop</span> <span class="hljs-variable">shop</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Shop</span>(id, <span class="hljs-string">&quot;xx&quot;</span>, <span class="hljs-literal">null</span>);<br>        map.put(id, shop);<br>        <span class="hljs-keyword">return</span> shop;<br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Data</span><br><span class="hljs-meta">@AllArgsConstructor</span><br><span class="hljs-meta">@NoArgsConstructor</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Shop</span> &#123;<br><br>    Integer id;<br><br><br>    String name;<br><br><br>    Integer stock;<br><br>&#125;<br></code></pre></td></tr></table></figure>
<p>在有大量重复对象时，使用享元模式可以节约不少的空间，但是当动态变得多的时候，享元工厂就得好好设计下了，避免对象的构建变得太复杂。</p>
<h3 id="代理模式">代理模式</h3>
<p>代理模式主要是用于一个程序(框架)对于使用者的易用性而服务的，在很多框架，组件中都有使用，Java中最常见的代理就是JDK代理和CGLIB代理，JDK代理只能代理接口，CGLIB代理可以代理接口和类。本次模拟MyBatis中使用接口就可以实现SQL语句的操作。</p>
<p>创建注解<code>Select</code>和接口<code>UserMapper</code>,并通过Spring配置文件的方式将<code>MyBeanDefinitionRegistryPostProcessor</code>注入为Bean,再通过实现<code>BeanDefinitionRegistryPostProcessor</code>接口的<code>postProcessBeanDefinitionRegistry</code>重新配置创建的Bean,将其配置为<code>UserMapper</code>代理，并在代理类中实现对于<code>Select</code>注解的匹配。代理的实现可以使用JDK或CGLIB。</p>
<p>目录</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs java">├─java<br>│  ├─annotation<br>│  │      Select.java<br>│  │      <br>│  ├─factory<br>│  │      MapperFactoryBean.java<br>│  │      <br>│  ├─handler<br>│  │  │  MyBeanDefinitionRegistryPostProcessor.java<br>│  │  │  <br>│  │  ├─cglib<br>│  │  │      CGLIBInvocationHandler.java<br>│  │  │      <br>│  │  └─jdk<br>│  │          JDKInvocationHandler.java<br>│  │          <br>│  └─mapper<br>│          UserMapper.java<br>│          <br>└─resources<br>        spring-config.xml<br></code></pre></td></tr></table></figure>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">&quot;1.0&quot;</span> encoding=<span class="hljs-string">&quot;UTF-8&quot;</span>?&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">beans</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">&quot;http://www.springframework.org/schema/beans&quot;</span></span><br><span class="hljs-tag">       <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span><br><span class="hljs-tag">       <span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-3.0.xsd&quot;</span></span><br><span class="hljs-tag">       <span class="hljs-attr">default-autowire</span>=<span class="hljs-string">&quot;byName&quot;</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;userMapper&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;handler.MyBeanDefinitionRegistryPostProcessor&quot;</span>/&gt;</span><br><br><span class="hljs-tag">&lt;/<span class="hljs-name">beans</span>&gt;</span><br></code></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">UserMapper</span> &#123;<br><br><br>    <span class="hljs-meta">@Select(&quot;&quot;&quot;</span><br><span class="hljs-meta">            select ...</span><br><span class="hljs-meta">            &quot;&quot;&quot;)</span><br>    String <span class="hljs-title function_">selectUserInfo</span><span class="hljs-params">(String userId)</span>;<br><br>&#125;<br>            <span class="hljs-meta">@Retention(RetentionPolicy.RUNTIME)</span><br><span class="hljs-meta">@Target(ElementType.METHOD)</span><br><span class="hljs-keyword">public</span> <span class="hljs-meta">@interface</span> Select &#123;<br><br>    String <span class="hljs-title function_">value</span><span class="hljs-params">()</span>;<br>&#125;<br></code></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyBeanDefinitionRegistryPostProcessor</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">BeanDefinitionRegistryPostProcessor</span> &#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">postProcessBeanDefinitionRegistry</span><span class="hljs-params">(BeanDefinitionRegistry beanDefinitionRegistry)</span> <span class="hljs-keyword">throws</span> BeansException &#123;<br>        <span class="hljs-comment">//在bean创建前可以对其操作(增删改查)</span><br>        <span class="hljs-type">var</span> <span class="hljs-variable">beanDefinition</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RootBeanDefinition</span>();<br>        beanDefinition.setBeanClass(MapperFactoryBean.class);<br>        beanDefinition.setScope(<span class="hljs-string">&quot;singleton&quot;</span>);<br>        <span class="hljs-type">var</span> <span class="hljs-variable">values</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">MutablePropertyValues</span>();<br>        values.add(<span class="hljs-string">&quot;interfaceClass&quot;</span>, UserMapper.class);<br>        beanDefinition.setPropertyValues(values);<br>        beanDefinitionRegistry.registerBeanDefinition(<span class="hljs-string">&quot;userMapper&quot;</span>, beanDefinition);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">postProcessBeanFactory</span><span class="hljs-params">(ConfigurableListableBeanFactory configurableListableBeanFactory)</span> <span class="hljs-keyword">throws</span> BeansException &#123;<br>        <span class="hljs-comment">// do not anything</span><br>    &#125;<br>&#125;<br><span class="hljs-meta">@SuppressWarnings(&quot;unchecked&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MapperFactoryBean</span>&lt;T&gt; <span class="hljs-keyword">implements</span> <span class="hljs-title class_">FactoryBean</span>&lt;T&gt; &#123;<br><br>    Class&lt;T&gt; interfaceClass;<br><br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> T <span class="hljs-title function_">getObject</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception &#123;<br><span class="hljs-comment">//         return (T) Proxy.newProxyInstance(Thread.currentThread().getContextClassLoader(), new Class[] &#123;interfaceClass&#125;, new JDKInvocationHandler());</span><br>        <span class="hljs-keyword">return</span> (T) Proxy.newProxyInstance(Thread.currentThread().getContextClassLoader(), <span class="hljs-keyword">new</span> <span class="hljs-title class_">Class</span>[] &#123;interfaceClass&#125;, <span class="hljs-keyword">new</span> <span class="hljs-title class_">CGLIBInvocationHandler</span>());<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> Class&lt;?&gt; getObjectType() &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">isSingleton</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setInterfaceClass</span><span class="hljs-params">(Class&lt;T&gt; interfaceClass)</span> &#123;<br>        <span class="hljs-built_in">this</span>.interfaceClass = interfaceClass;<br>    &#125;<br>&#125;<br><span class="hljs-comment">//代理实现</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CGLIBInvocationHandler</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">InvocationHandler</span> &#123;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">invoke</span><span class="hljs-params">(Object o, Method method, Object[] objects)</span> <span class="hljs-keyword">throws</span> Throwable &#123;<br>        <span class="hljs-type">Select</span> <span class="hljs-variable">annotation</span> <span class="hljs-operator">=</span> method.getAnnotation(Select.class);<br>        <span class="hljs-type">String</span> <span class="hljs-variable">value</span> <span class="hljs-operator">=</span> annotation.value();<br>        <span class="hljs-keyword">return</span> value + objects[<span class="hljs-number">0</span>];<br>    &#125;<br>&#125;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">JDKInvocationHandler</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">InvocationHandler</span> &#123;<br><br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">invoke</span><span class="hljs-params">(Object proxy, Method method, Object[] args)</span> <span class="hljs-keyword">throws</span> Throwable &#123;<br>        <span class="hljs-type">Select</span> <span class="hljs-variable">annotation</span> <span class="hljs-operator">=</span> method.getAnnotation(Select.class);<br>        <span class="hljs-type">String</span> <span class="hljs-variable">value</span> <span class="hljs-operator">=</span> annotation.value();<br>        <span class="hljs-keyword">return</span> value + args[<span class="hljs-number">0</span>];<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<p>代理模式可以使得代码变得简洁，使用代理模式可以很轻松的扩展我们的业务逻辑，代理模式+门面模式经常在中间件开发中使用。</p>
<h3 id="责任链模式">责任链模式</h3>
<p>当某一个程序需要经历很多层计算或者是某个业务需要很多层审批的时候，使用责任链模式可以使代码变得简洁，易懂，这里模拟一道题目需要层层计算得到最终答案的流程。</p>
<p>目录</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java">├─algorithm<br>│      Algorithm.java<br>│<br>├─impl<br>│      Alogrithm1.java<br>│      Alogrithm2.java<br>│      Alogrithm3.java<br>│<br>└─res<br>        R.java<br></code></pre></td></tr></table></figure>
<p>定义核心算法抽象类<code>Algorithm</code>,并在其中创建算法链，当每创建一个算法的时候就将该算法放置在链中，定义抽象方法<code>calculate</code>,基于实现类实现具体的算法细节，每次计算后都返回答案和是否需要进行下一轮计算。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Algorithm</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> List&lt;Algorithm&gt; chain = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();<br><br>    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">static</span> <span class="hljs-type">Logger</span> <span class="hljs-variable">logger</span> <span class="hljs-operator">=</span> LoggerFactory.getLogger(Algorithm.class);<br><br>    String name;<br><br><br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Algorithm</span><span class="hljs-params">(String _name)</span> &#123;<br>        name = _name;<br>        chain.add(<span class="hljs-built_in">this</span>);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getName</span><span class="hljs-params">()</span> &#123;<span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>.name;&#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> R <span class="hljs-title function_">calculate</span><span class="hljs-params">(String question)</span>;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> R <span class="hljs-title function_">doCalculate</span><span class="hljs-params">(String question)</span> &#123;<br>        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> e : chain) &#123;<br>            <span class="hljs-type">R</span> <span class="hljs-variable">res</span> <span class="hljs-operator">=</span> e.calculate(question);<br>            <span class="hljs-keyword">if</span> (res.haveNext()) question = res.answer();<br>            <span class="hljs-keyword">else</span> <span class="hljs-keyword">return</span> res;<br>        &#125;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">R</span>(<span class="hljs-literal">null</span>,<span class="hljs-literal">null</span>, <span class="hljs-literal">null</span>);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">buildAlgorithmChain</span><span class="hljs-params">(Algorithm ... algorithms)</span> &#123;<br>        chain.addAll(Arrays.asList(algorithms));<br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Alogrithm1</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Algorithm</span> &#123;<br><br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Alogrithm1</span><span class="hljs-params">(String _name)</span> &#123;<br>        <span class="hljs-built_in">super</span>(_name);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> R <span class="hljs-title function_">calculate</span><span class="hljs-params">(String question)</span> &#123;<br>        <span class="hljs-type">boolean</span> <span class="hljs-variable">condition</span> <span class="hljs-operator">=</span> <span class="hljs-literal">false</span>;<br>        logger.info(<span class="hljs-string">&quot;执行&quot;</span> + getName() + <span class="hljs-string">&quot;算法成功&quot;</span>);<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">R</span>(<span class="hljs-string">&quot;执行&quot;</span> + getName() + <span class="hljs-string">&quot;算法成功&quot;</span>, question + <span class="hljs-string">&quot;*&quot;</span>, condition);<br>    &#125;<br>&#125;<br><br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Alogrithm2</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Algorithm</span> &#123;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Alogrithm2</span><span class="hljs-params">(String _name)</span> &#123;<br>        <span class="hljs-built_in">super</span>(_name);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> R <span class="hljs-title function_">calculate</span><span class="hljs-params">(String question)</span> &#123;<br>        <span class="hljs-type">boolean</span> <span class="hljs-variable">condition</span> <span class="hljs-operator">=</span> <span class="hljs-literal">true</span>;<br>        logger.info(<span class="hljs-string">&quot;执行&quot;</span> + getName() + <span class="hljs-string">&quot;算法成功&quot;</span>);<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">R</span>(<span class="hljs-string">&quot;执行&quot;</span> + getName() + <span class="hljs-string">&quot;算法成功&quot;</span>, question + <span class="hljs-string">&quot;*&quot;</span>, condition);<br>    &#125;<br>&#125;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Alogrithm3</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Algorithm</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Alogrithm3</span><span class="hljs-params">(String _name)</span> &#123;<br>        <span class="hljs-built_in">super</span>(_name);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> R <span class="hljs-title function_">calculate</span><span class="hljs-params">(String question)</span> &#123;<br>        <span class="hljs-type">boolean</span> <span class="hljs-variable">condition</span> <span class="hljs-operator">=</span> <span class="hljs-literal">true</span>;<br>        logger.info(<span class="hljs-string">&quot;执行&quot;</span> + getName() + <span class="hljs-string">&quot;算法成功&quot;</span>);<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">R</span>(<span class="hljs-string">&quot;执行&quot;</span> + getName() + <span class="hljs-string">&quot;算法成功&quot;</span>, question + <span class="hljs-string">&quot;*&quot;</span>, condition);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<p>责任链模式体现了单一职责和开闭原则，我们只需要定义出需要哪些层，而不需要懂得这些层具体细节，在外部调用的时候极大缩减了上手难度。</p>
<h3 id="命令模式">命令模式</h3>
<p>命令模式的核心大致有两点，一个就是将参数以对象的形式进行传递，另一个就是将命令，执行者，调用者分开，调用者只需创建对象，统一化下达命令，其余有执行者进行实现。本次模拟开灯和关灯的操作使用命令模式实现。</p>
<p>目录</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java">com<br>    └─cm<br>        │  ICommand.java<br>        │  Invoker.java<br>        │  Light.java<br>        │<br>        └─impl<br>                TurnOffCommand.java<br>                TurnOnCommand.java<br><br></code></pre></td></tr></table></figure>
<p>定义<code>Light</code>类，里面实现开灯和关灯的方法。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Light</span> &#123;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">turnOn</span><span class="hljs-params">()</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;开灯&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">turnOff</span><span class="hljs-params">()</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;关灯&quot;</span>);<br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure>
<p>定义统一命令接口，并实现开灯和关灯的操作</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">ICommand</span> &#123;<br><br><br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">execute</span><span class="hljs-params">()</span>;<br><br>&#125;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TurnOffCommand</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">ICommand</span> &#123;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Light light;<br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">TurnOffCommand</span><span class="hljs-params">(Light light)</span> &#123;<br>        <span class="hljs-built_in">this</span>.light = light;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">execute</span><span class="hljs-params">()</span> &#123;<br>        light.turnOff();<br>    &#125;<br>&#125;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TurnOnCommand</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">ICommand</span> &#123;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Light light;<br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">TurnOnCommand</span><span class="hljs-params">(Light light)</span> &#123;<br>        <span class="hljs-built_in">this</span>.light = light;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">execute</span><span class="hljs-params">()</span> &#123;<br>        light.turnOn();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<p>实现<code>Invoker</code>类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Invoker</span> &#123;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Runnable action;<br><br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Invoker</span><span class="hljs-params">(Runnable action)</span> &#123;<br>        <span class="hljs-built_in">this</span>.action = action;<br>    &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">invoke</span><span class="hljs-params">()</span> &#123;<br>        action.run();<br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure>
<p>通过命令模式可以很好的将各层进行分开，互不干涉，需要其他的命令只需添加即可，无需改动当前的代码，体现了开闭原则和单一职责。</p>
<h3 id="迭代器模式">迭代器模式</h3>
<p>迭代器模式在Java的集合体系中使用的相当广泛，每一个数据结构都实现了迭代功能，迭代器模式可以自定义遍历的方式，外部只需要要遍历无需关心遍历的细节。这里手撕一个堆来举例。</p>
<p>目录</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java">MyHeap.java<br></code></pre></td></tr></table></figure>
<p>Java本身就提供了迭代的接口<code>Iterable</code>,只需实现这个并重写里面的<code>iterator</code>方法即可，<code>iterator</code>方法返回的是一个<code>Iterator</code>对象，进而创建<code>Iterator</code>，实现里面的<code>hasNext</code>和<code>next</code>即可。关于堆的实现不做阐述，属于算法内容。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> java.util.Comparator;<br><span class="hljs-keyword">import</span> java.util.Iterator;<br><br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 堆是一个完全二叉树</span><br><span class="hljs-comment"> * 小根堆的最小为根</span><br><span class="hljs-comment"> * 大根堆的最大为根</span><br><span class="hljs-comment"> * 存储: 使用一个数组来存, 1号点为根, 左儿子为2x,右儿子为2x+1</span><br><span class="hljs-comment"> * 两个基本操作: down(x), up(x)</span><br><span class="hljs-comment"> * 删除的时候有技巧: 用最后一个元素覆盖第一个元素, 然后删除最后一个元素</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyHeap</span>&lt;T&gt; <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Iterable</span>&lt;T&gt;&#123;<br><br><br>    <span class="hljs-keyword">private</span> Comparator&lt;? <span class="hljs-built_in">super</span> T&gt; comparator;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> T[] array;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> size;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> sum;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">MyHeap</span><span class="hljs-params">(<span class="hljs-type">int</span> initSize, Comparator&lt;T&gt; comparator)</span> &#123;<br>        <span class="hljs-built_in">this</span>.comparator = comparator;<br>        array = (T[]) <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>[initSize + <span class="hljs-number">1</span>];<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">MyHeap</span><span class="hljs-params">(<span class="hljs-type">int</span> maxSize)</span> &#123;<br>        array = (T[]) <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>[maxSize + <span class="hljs-number">1</span>];<br>    &#125;<br><br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> maxSize 最大容量</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> heapifyArray 需要被heapify的数组</span><br><span class="hljs-comment">     * 时间复杂度O(n)</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">MyHeap</span><span class="hljs-params">(<span class="hljs-type">int</span> maxSize, T[] heapifyArray)</span> &#123;<br>        array = (T[]) <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>[maxSize + <span class="hljs-number">1</span>];<br>        System.arraycopy(heapifyArray, <span class="hljs-number">1</span>, array, <span class="hljs-number">1</span>, heapifyArray.length - <span class="hljs-number">1</span>);<br>        size = heapifyArray.length;<br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> heapifyArray.length / <span class="hljs-number">2</span>; i &gt;= <span class="hljs-number">1</span>; i--) down(i);<br>    &#125;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> <span class="hljs-title function_">compare</span><span class="hljs-params">(T a, T b)</span> &#123;<br>        <span class="hljs-keyword">if</span> (comparator != <span class="hljs-literal">null</span>) <span class="hljs-keyword">return</span> comparator.compare(a, b);<br>        <span class="hljs-keyword">if</span> (a <span class="hljs-keyword">instanceof</span> Comparable&lt;?&gt;) <span class="hljs-keyword">return</span> ((Comparable&lt;? <span class="hljs-built_in">super</span> T&gt;) a).compareTo(b);<br>        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UnsupportedOperationException</span>(<span class="hljs-string">&quot;必须有一个比较规则&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 核心算法: 向下调整</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> u 从此节点开始down</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">down</span><span class="hljs-params">(<span class="hljs-type">int</span> u)</span> &#123;<br>        <span class="hljs-type">int</span> <span class="hljs-variable">t</span> <span class="hljs-operator">=</span> u;<br>        <span class="hljs-keyword">if</span> (u * <span class="hljs-number">2</span> &lt;= size &amp;&amp; compare(array[u * <span class="hljs-number">2</span>], array[u]) &lt; <span class="hljs-number">0</span>) t = u * <span class="hljs-number">2</span>;<br>        <span class="hljs-keyword">if</span> (u * <span class="hljs-number">2</span> + <span class="hljs-number">1</span> &lt;= size &amp;&amp; compare(array[u * <span class="hljs-number">2</span> + <span class="hljs-number">1</span>], array[t]) &lt; <span class="hljs-number">0</span>) t = u * <span class="hljs-number">2</span> + <span class="hljs-number">1</span>;<br>        <span class="hljs-keyword">if</span> (u != t) &#123;<br>            swap(u, t);<br>            down(t);<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 核心算法: 向上调整</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> u 从此节点开始up</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">up</span><span class="hljs-params">(<span class="hljs-type">int</span> u)</span> &#123;<br>        <span class="hljs-keyword">while</span> (u / <span class="hljs-number">2</span> &gt; <span class="hljs-number">0</span> &amp;&amp; compare(array[u / <span class="hljs-number">2</span>], array[u]) &gt; <span class="hljs-number">0</span>) &#123;<br>            swap(u, u / <span class="hljs-number">2</span>);<br>            u /= <span class="hljs-number">2</span>;<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">swap</span><span class="hljs-params">(<span class="hljs-type">int</span> i, <span class="hljs-type">int</span> j)</span> &#123;<br>        <span class="hljs-type">T</span> <span class="hljs-variable">temp</span> <span class="hljs-operator">=</span> array[i];<br>        array[i] = array[j];<br>        array[j] = temp;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> T <span class="hljs-title function_">poll</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">if</span> (size == <span class="hljs-number">0</span>) <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalStateException</span>(<span class="hljs-string">&quot;堆是空的!&quot;</span>);<br>        <span class="hljs-type">T</span> <span class="hljs-variable">ret</span> <span class="hljs-operator">=</span> array[<span class="hljs-number">1</span>];<br>        array[<span class="hljs-number">1</span>] = array[size];<br>        size--;<br>        down(<span class="hljs-number">1</span>);<br>        <span class="hljs-keyword">if</span> (ret <span class="hljs-keyword">instanceof</span> Integer av) &#123;<br>            sum -= av;<br>        &#125;<br>        <span class="hljs-keyword">return</span> ret;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">add</span><span class="hljs-params">(T v)</span> &#123;<br>        <span class="hljs-keyword">if</span> (size == array.length -<span class="hljs-number">1</span>) <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalStateException</span>(<span class="hljs-string">&quot;堆满了!&quot;</span>);<br>        size++;<br>        array[size] = v;<br>        up(size);<br>        <span class="hljs-keyword">if</span> (v <span class="hljs-keyword">instanceof</span> Integer av) &#123;<br>            sum += av;<br>        &#125;<br><br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">isEmpty</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> size == <span class="hljs-number">0</span>;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> T <span class="hljs-title function_">peek</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> array[<span class="hljs-number">1</span>];<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">size</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> size;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getSum</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> sum;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> Iterator&lt;T&gt; <span class="hljs-title function_">iterator</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Iterator</span>&lt;T&gt;() &#123;<br><br>            <span class="hljs-type">int</span> <span class="hljs-variable">it</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;<br><br>            <span class="hljs-meta">@Override</span><br>            <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">hasNext</span><span class="hljs-params">()</span> &#123;<br>                <span class="hljs-keyword">return</span> it &lt;= size();<br>            &#125;<br><br>            <span class="hljs-meta">@Override</span><br>            <span class="hljs-keyword">public</span> T <span class="hljs-title function_">next</span><span class="hljs-params">()</span> &#123;<br>                <span class="hljs-keyword">if</span> (!hasNext()) <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalStateException</span>(<span class="hljs-string">&quot;已经到尾了&quot;</span>);<br>                <span class="hljs-keyword">return</span> array[it++];<br>            &#125;<br>        &#125;;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<p>通常情况下无需我们实现迭代器，但是在特殊情况下，根据业务需求还是可能用得到的。</p>
<h3 id="中介者模式">中介者模式</h3>
<p>中介者模式主要用于各个对象之间的解耦，当有多种多类的对象需要相互作用的时候，行为的关系将变得非常复杂，整个关系图会变得非常复杂，但是如果采用中介者模式进行优化的话，那么这个图将会变成一个星行图。</p>
<p>目录</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java">├─lease<br>│      HouseLease.java<br>│      Lease.java<br>│      <br>├─mediator<br>│      HouseMediator.java<br>│      Mediator.java<br>│      <br>└─rent<br>        HouseRent.java<br>        Rent.java<br></code></pre></td></tr></table></figure>
<p>抽象出租者、卖家、买家三个角色，通过中介者来凑合它们。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Mediator</span> &#123;<br><br>    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">static</span> Deque&lt;Rent&gt; rentQueue = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayDeque</span>&lt;&gt;();<br><br>    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">static</span> Deque&lt;Lease&gt; leaseQueue = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayDeque</span>&lt;&gt;();<br><br><br><br>    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">trade</span><span class="hljs-params">(Lease lease)</span>;<br><br>    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">trade</span><span class="hljs-params">(Rent rent)</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">buy</span><span class="hljs-params">(Rent rent)</span> &#123;<br>        rentQueue.add(rent);<br>        trade(rent);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">sell</span><span class="hljs-params">(Lease lease)</span> &#123;<br>        leaseQueue.add(lease);<br>        trade(lease);<br>    &#125;<br>&#125;<br><br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Rent</span> &#123;<br><br><br>    <span class="hljs-keyword">protected</span> String name;<br><br>    <span class="hljs-keyword">protected</span> Long money;<br><br>    <span class="hljs-keyword">protected</span> Mediator mediator; <span class="hljs-comment">//miːdieɪtər/</span><br><br><br>    <span class="hljs-keyword">protected</span> <span class="hljs-title function_">Rent</span><span class="hljs-params">(String name, Long money, Mediator mediator)</span> &#123;<br>        <span class="hljs-built_in">this</span>.money = money;<br>        <span class="hljs-built_in">this</span>.name = name;<br>        <span class="hljs-built_in">this</span>.mediator = mediator;<br>    &#125;<br><br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">rent</span><span class="hljs-params">()</span>;<br><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getName</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> name;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> Long <span class="hljs-title function_">getMoney</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> money;<br>    &#125;<br><br>&#125;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Lease</span> &#123;<br><br>    <span class="hljs-keyword">protected</span> String name;<br><br>    <span class="hljs-keyword">protected</span> Long money;<br><br>    <span class="hljs-keyword">protected</span> Mediator mediator; <span class="hljs-comment">//miːdieɪtər/</span><br><br><br>    <span class="hljs-keyword">protected</span> <span class="hljs-title function_">Lease</span><span class="hljs-params">(String name, Long money, Mediator mediator)</span> &#123;<br>        <span class="hljs-built_in">this</span>.money = money;<br>        <span class="hljs-built_in">this</span>.name = name;<br>        <span class="hljs-built_in">this</span>.mediator = mediator;<br>    &#125;<br><br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">lease</span><span class="hljs-params">()</span>;<br><br><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getName</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> name;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> Long <span class="hljs-title function_">getMoney</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> money;<br>    &#125;<br><br>&#125;<br><span class="hljs-comment">//这里后来想了想，感觉把角色抽象成一个抽象类，行为定义成接口似乎更好一点。</span><br></code></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HouseMediator</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Mediator</span>&#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">trade</span><span class="hljs-params">(Lease lease)</span> &#123;<br><br>        Iterator&lt;Rent&gt; iterator = Mediator.rentQueue.iterator();<br>        <span class="hljs-keyword">while</span> (iterator.hasNext()) &#123;<br>            <span class="hljs-type">var</span> <span class="hljs-variable">r</span> <span class="hljs-operator">=</span> iterator.next();<br>            <span class="hljs-keyword">if</span> (r.getName().equals(lease.getName()) &amp;&amp; r.getMoney() &gt;= lease.getMoney()) &#123;<br>                System.out.println(<span class="hljs-string">&quot;双方交易成功&quot;</span>);<br>                iterator.remove();<br>                <span class="hljs-keyword">return</span>;<br>            &#125;<br>        &#125;<br>        System.out.println(<span class="hljs-string">&quot;暂无买家&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">trade</span><span class="hljs-params">(Rent rent)</span> &#123;<br>        Iterator&lt;Lease&gt; iterator = Mediator.leaseQueue.iterator();<br>        <span class="hljs-keyword">while</span> (iterator.hasNext()) &#123;<br>            <span class="hljs-type">var</span> <span class="hljs-variable">l</span> <span class="hljs-operator">=</span> iterator.next();<br>            <span class="hljs-keyword">if</span> (l.getName().equals(rent.getName()) &amp;&amp; rent.getMoney() &gt;= l.getMoney()) &#123;<br>                System.out.println(<span class="hljs-string">&quot;双方交易成功&quot;</span>);<br>                iterator.remove();<br>                <span class="hljs-keyword">return</span>;<br>            &#125;<br>        &#125;<br>        System.out.println(<span class="hljs-string">&quot;暂无卖家&quot;</span>);<br>    &#125;<br>&#125;<br><br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HouseLease</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Lease</span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">HouseLease</span><span class="hljs-params">(String name, Long money, Mediator mediator)</span> &#123;<br>        <span class="hljs-built_in">super</span>(name, money, mediator);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">lease</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-built_in">super</span>.mediator.sell(<span class="hljs-built_in">this</span>);<br>    &#125;<br><br><br>&#125;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HouseRent</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Rent</span>&#123;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">HouseRent</span><span class="hljs-params">(String name, Long money, Mediator mediator)</span> &#123;<br>        <span class="hljs-built_in">super</span>(name, money, mediator);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">rent</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-built_in">super</span>.mediator.buy(<span class="hljs-built_in">this</span>);<br>    &#125;<br><br><br>&#125;<br></code></pre></td></tr></table></figure>
<p>在此案例中，出租房的中介者的行为就很明确，就是进行交易，无论是买家还是买家，它们只需要和中介者进行交流即可，无需构建复杂的关系图。</p>
<h3 id="观察者模式">观察者模式</h3>
<p>观察者模式又被称作发布订阅模式，当被观察者做出某种行为时，观察者也会做出一些行为，通知其他有关的对象。本案例模仿买票的时候，买完票一般都会有个短信通知。</p>
<p>目录</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java">├─listener<br>│      Listener.java<br>│      ListenerManager.java<br>│      MessageListener.java<br>│<br>└─sell<br>        Sell.java<br>        SellImpl.java<br></code></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//定义监听事件具体内容</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">Listener</span> &#123;<br><br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">doEvent</span><span class="hljs-params">(Long userId)</span>;<br><br>&#125;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MessageListener</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Listener</span>&#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">doEvent</span><span class="hljs-params">(Long userId)</span> &#123;<br>        System.out.println(userId + <span class="hljs-string">&quot;成功购买了一张票， 发个短信通知下他&quot;</span>);<br>    &#125;<br>&#125;<br><br><span class="hljs-comment">//监听器的管理者，可以支持订阅，取消订阅，推送</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ListenerManager</span> &#123;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">enum</span> <span class="hljs-title class_">EventType</span> &#123;<br><br>        MESSAGE<br><br>    &#125;<br><br>    Map&lt;Enum&lt;EventType&gt;, Listener&gt; map = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">subscribe</span><span class="hljs-params">(Enum&lt;EventType&gt; eventTypeEnum, Listener listener)</span> &#123;<br>        map.put(eventTypeEnum, listener);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">unsubscribe</span><span class="hljs-params">(Enum&lt;EventType&gt; eventTypeEnum)</span> &#123;<br>        map.remove(eventTypeEnum);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">notify</span><span class="hljs-params">(Enum&lt;EventType&gt; eventTypeEnum, Long userId)</span> &#123;<br>        map.get(eventTypeEnum).doEvent(userId);<br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">Sell</span> &#123;<br><br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">sell</span><span class="hljs-params">(Long userId)</span>;<br><br>&#125;<br><span class="hljs-comment">//在卖票成功的时候发布通知</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SellImpl</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Sell</span>&#123;<br><br>    ListenerManager manager;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">SellImpl</span><span class="hljs-params">()</span> &#123;<br>        manager = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ListenerManager</span>();<br>        manager.subscribe(ListenerManager.EventType.MESSAGE, <span class="hljs-keyword">new</span> <span class="hljs-title class_">MessageListener</span>());<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">sell</span><span class="hljs-params">(Long userId)</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;成功卖票&quot;</span>);<br>        manager.notify(ListenerManager.EventType.MESSAGE, userId);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<p>通过观察者模式可以看出，当进行某一操作时，如果有需要和其关联的事件发生时，就能够通过简单的配置得以通知，并不需要写死代码。观察者模式在我们使用MQ时能够体现出。</p>
<h3 id="状态机模式">状态机模式</h3>
<p>状态机模式（State Pattern）是一种行为型设计模式，它允许一个对象在其内部状态改变时改变其行为。这种类型的设计模式属于状态模式的一种，它提供了一种方法来封装对象的状态变化以及转换的逻辑。状态机模式的核心思想是将一个复杂的问题分解为若干个状态，并将每个状态相关的行为封装在一个类的各个状态中。通过将行为与状态进行关联，状态机可以根据当前状态在运行时灵活地切换行为。本案例以一个活动的执行来举例。</p>
<p><img src="https://image.itbaima.cn/images/76/image-20240318154358890.png" srcset="/img/loading.gif" lazyload></img></p>
<p>目录</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs java">├─r<br>│      ActivityInfo.java<br>│      DefaultRefuseResult.java<br>│      Result.java<br>│      Status.java<br>│<br>├─service<br>│      ActivityService.java<br>│<br>└─state<br>    │  State.java<br>    │  StateMachine.java<br>    │<br>    └─impl<br>            CheckState.java<br>            CloseState.java<br>            DoingState.java<br>            EditingState.java<br>            OpenState.java<br>            PassState.java<br>            RefuseState.java<br></code></pre></td></tr></table></figure>
<p>定义基本信息，活动详情，返回对象，状态枚举。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ActivityInfo</span> &#123;<br><br>    <span class="hljs-keyword">private</span> String activityId;    <span class="hljs-comment">// 活动ID</span><br>    <span class="hljs-keyword">private</span> String activityName;  <span class="hljs-comment">// 活动名称</span><br>    <span class="hljs-keyword">private</span> Enum&lt;Status&gt; status;  <span class="hljs-comment">// 活动状态</span><br>    <span class="hljs-keyword">private</span> Date beginTime;       <span class="hljs-comment">// 开始时间</span><br>    <span class="hljs-keyword">private</span> Date endTime;         <span class="hljs-comment">// 结束时间</span><br><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getActivityId</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> activityId;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setActivityId</span><span class="hljs-params">(String activityId)</span> &#123;<br>        <span class="hljs-built_in">this</span>.activityId = activityId;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getActivityName</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> activityName;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setActivityName</span><span class="hljs-params">(String activityName)</span> &#123;<br>        <span class="hljs-built_in">this</span>.activityName = activityName;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> Enum&lt;Status&gt; <span class="hljs-title function_">getStatus</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> status;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setStatus</span><span class="hljs-params">(Enum&lt;Status&gt; status)</span> &#123;<br>        <span class="hljs-built_in">this</span>.status = status;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> Date <span class="hljs-title function_">getBeginTime</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> beginTime;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setBeginTime</span><span class="hljs-params">(Date beginTime)</span> &#123;<br>        <span class="hljs-built_in">this</span>.beginTime = beginTime;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> Date <span class="hljs-title function_">getEndTime</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> endTime;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setEndTime</span><span class="hljs-params">(Date endTime)</span> &#123;<br>        <span class="hljs-built_in">this</span>.endTime = endTime;<br>    &#125;<br>&#125;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Result</span> &#123;<br><br>    <span class="hljs-keyword">private</span> String code; <span class="hljs-comment">// 编码</span><br>    <span class="hljs-keyword">private</span> String info; <span class="hljs-comment">// 描述</span><br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Result</span><span class="hljs-params">(String code, String info)</span> &#123;<br>        <span class="hljs-built_in">this</span>.code = code;<br>        <span class="hljs-built_in">this</span>.info = info;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getCode</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> code;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setCode</span><span class="hljs-params">(String code)</span> &#123;<br>        <span class="hljs-built_in">this</span>.code = code;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getInfo</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> info;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setInfo</span><span class="hljs-params">(String info)</span> &#123;<br>        <span class="hljs-built_in">this</span>.info = info;<br>    &#125;<br><br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">equals</span><span class="hljs-params">(Object obj)</span> &#123;<br>        <span class="hljs-keyword">if</span> (obj <span class="hljs-keyword">instanceof</span> Result result) &#123;<br>            <span class="hljs-keyword">return</span> Objects.equals(<span class="hljs-built_in">this</span>.code, result.code) &amp;&amp; <span class="hljs-built_in">this</span>.info.equals(result.info);<br>        &#125;<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>    &#125;<br>&#125;<br><br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DefaultRefuseResult</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Result</span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">DefaultRefuseResult</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-built_in">super</span>(<span class="hljs-string">&quot;0000&quot;</span>, <span class="hljs-string">&quot;当前状态不可达此状态&quot;</span>);<br>    &#125;<br>&#125;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">enum</span> <span class="hljs-title class_">Status</span> &#123;<br><br>    <span class="hljs-comment">// 1创建编辑、2待审核、3审核通过(任务扫描成活动中)、4审核拒绝(可以撤审到编辑状态)、5活动中、6活动关闭、7活动开启(任务扫描成活动中)</span><br>    Editing &#123;<br>        <span class="hljs-meta">@Override</span><br>        <span class="hljs-keyword">public</span> Status <span class="hljs-title function_">defaultNextStatus</span><span class="hljs-params">(Status status)</span> &#123;<br>            <span class="hljs-keyword">return</span> Check;<br>        &#125;<br>    &#125;,<br>    Check &#123;<br>        <span class="hljs-meta">@Override</span><br>        <span class="hljs-keyword">public</span> Status <span class="hljs-title function_">defaultNextStatus</span><span class="hljs-params">(Status status)</span> &#123;<br>            <span class="hljs-keyword">return</span> Pass;<br>        &#125;<br>    &#125;,<br>    Pass &#123;<br>        <span class="hljs-meta">@Override</span><br>        <span class="hljs-keyword">public</span> Status <span class="hljs-title function_">defaultNextStatus</span><span class="hljs-params">(Status status)</span> &#123;<br>            <span class="hljs-keyword">return</span> Doing;<br>        &#125;<br>    &#125;,<br>    Refuse,<br>    Doing &#123;<br>        <span class="hljs-meta">@Override</span><br>        <span class="hljs-keyword">public</span> Status <span class="hljs-title function_">defaultNextStatus</span><span class="hljs-params">(Status status)</span> &#123;<br>            <span class="hljs-keyword">return</span> Close;<br>        &#125;<br>    &#125;,<br>    Close,<br>    Open;<br><br>    <span class="hljs-keyword">public</span> Status <span class="hljs-title function_">defaultNextStatus</span><span class="hljs-params">(Status status)</span> &#123;<br>        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalStateException</span>(<span class="hljs-string">&quot;未定义默认下一个状态&quot;</span>);<br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//定义状态接口</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">State</span> &#123;<br><br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 活动提审</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> activityId    活动ID</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> currentStatus 当前状态</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> 执行结果</span><br><span class="hljs-comment">     */</span><br>    Result <span class="hljs-title function_">arraignment</span><span class="hljs-params">(String activityId, Enum&lt;Status&gt; currentStatus)</span>;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 审核通过</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> activityId    活动ID</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> currentStatus 当前状态</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> 执行结果</span><br><span class="hljs-comment">     */</span><br>    Result <span class="hljs-title function_">checkPass</span><span class="hljs-params">(String activityId, Enum&lt;Status&gt; currentStatus)</span>;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 审核拒绝</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> activityId    活动ID</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> currentStatus 当前状态</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> 执行结果</span><br><span class="hljs-comment">     */</span><br>    Result <span class="hljs-title function_">checkRefuse</span><span class="hljs-params">(String activityId, Enum&lt;Status&gt; currentStatus)</span>;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 撤审撤销</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> activityId    活动ID</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> currentStatus 当前状态</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> 执行结果</span><br><span class="hljs-comment">     */</span><br>    Result <span class="hljs-title function_">checkRevoke</span><span class="hljs-params">(String activityId, Enum&lt;Status&gt; currentStatus)</span>;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 活动关闭</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> activityId    活动ID</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> currentStatus 当前状态</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> 执行结果</span><br><span class="hljs-comment">     */</span><br>    Result <span class="hljs-title function_">close</span><span class="hljs-params">(String activityId, Enum&lt;Status&gt; currentStatus)</span>;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 活动开启</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> activityId    活动ID</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> currentStatus 当前状态</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> 执行结果</span><br><span class="hljs-comment">     */</span><br>    Result <span class="hljs-title function_">open</span><span class="hljs-params">(String activityId, Enum&lt;Status&gt; currentStatus)</span>;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 活动执行</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> activityId    活动ID</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> currentStatus 当前状态</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> 执行结果</span><br><span class="hljs-comment">     */</span><br>    Result <span class="hljs-title function_">doing</span><span class="hljs-params">(String activityId, Enum&lt;Status&gt; currentStatus)</span>;<br><br><br>    <span class="hljs-keyword">default</span> Result <span class="hljs-title function_">doDefaultNextAction</span><span class="hljs-params">(String activityId, Enum&lt;Status&gt; currentStatus)</span> &#123;<br>        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalStateException</span>(<span class="hljs-string">&quot;没有下一个默认的操作&quot;</span>);<br>    &#125;<br>&#125;<br><br><span class="hljs-comment">//每种状态均实现，在其内部定义状态转变</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CheckState</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">State</span> &#123;<br><br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> Result <span class="hljs-title function_">arraignment</span><span class="hljs-params">(String activityId, Enum&lt;Status&gt; currentStatus)</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">DefaultRefuseResult</span>();<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> Result <span class="hljs-title function_">checkPass</span><span class="hljs-params">(String activityId, Enum&lt;Status&gt; currentStatus)</span> &#123;<br>        ActivityService.execStatus(activityId, currentStatus, Status.Pass);<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Result</span>(<span class="hljs-string">&quot;0000&quot;</span>, <span class="hljs-string">&quot;活动审核通过完成&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> Result <span class="hljs-title function_">checkRefuse</span><span class="hljs-params">(String activityId, Enum&lt;Status&gt; currentStatus)</span> &#123;<br>        ActivityService.execStatus(activityId, currentStatus, Status.Refuse);<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Result</span>(<span class="hljs-string">&quot;0000&quot;</span>, <span class="hljs-string">&quot;活动审核拒绝完成&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> Result <span class="hljs-title function_">checkRevoke</span><span class="hljs-params">(String activityId, Enum&lt;Status&gt; currentStatus)</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">DefaultRefuseResult</span>();<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> Result <span class="hljs-title function_">close</span><span class="hljs-params">(String activityId, Enum&lt;Status&gt; currentStatus)</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">DefaultRefuseResult</span>();<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> Result <span class="hljs-title function_">open</span><span class="hljs-params">(String activityId, Enum&lt;Status&gt; currentStatus)</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">DefaultRefuseResult</span>();<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> Result <span class="hljs-title function_">doing</span><span class="hljs-params">(String activityId, Enum&lt;Status&gt; currentStatus)</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">DefaultRefuseResult</span>();<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> Result <span class="hljs-title function_">doDefaultNextAction</span><span class="hljs-params">(String activityId, Enum&lt;Status&gt; currentStatus)</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>.checkPass(activityId, currentStatus);<br>    &#125;<br>&#125;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CloseState</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">State</span> &#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> Result <span class="hljs-title function_">arraignment</span><span class="hljs-params">(String activityId, Enum&lt;Status&gt; currentStatus)</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">DefaultRefuseResult</span>();<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> Result <span class="hljs-title function_">checkPass</span><span class="hljs-params">(String activityId, Enum&lt;Status&gt; currentStatus)</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">DefaultRefuseResult</span>();<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> Result <span class="hljs-title function_">checkRefuse</span><span class="hljs-params">(String activityId, Enum&lt;Status&gt; currentStatus)</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">DefaultRefuseResult</span>();<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> Result <span class="hljs-title function_">checkRevoke</span><span class="hljs-params">(String activityId, Enum&lt;Status&gt; currentStatus)</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">DefaultRefuseResult</span>();<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> Result <span class="hljs-title function_">close</span><span class="hljs-params">(String activityId, Enum&lt;Status&gt; currentStatus)</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">DefaultRefuseResult</span>();<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> Result <span class="hljs-title function_">open</span><span class="hljs-params">(String activityId, Enum&lt;Status&gt; currentStatus)</span> &#123;<br>        ActivityService.execStatus(activityId, currentStatus, Status.Open);<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Result</span>(<span class="hljs-string">&quot;0000&quot;</span>, <span class="hljs-string">&quot;活动开启完成&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> Result <span class="hljs-title function_">doing</span><span class="hljs-params">(String activityId, Enum&lt;Status&gt; currentStatus)</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">DefaultRefuseResult</span>();<br>    &#125;<br>&#125;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DoingState</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">State</span> &#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> Result <span class="hljs-title function_">arraignment</span><span class="hljs-params">(String activityId, Enum&lt;Status&gt; currentStatus)</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">DefaultRefuseResult</span>();<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> Result <span class="hljs-title function_">checkPass</span><span class="hljs-params">(String activityId, Enum&lt;Status&gt; currentStatus)</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">DefaultRefuseResult</span>();<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> Result <span class="hljs-title function_">checkRefuse</span><span class="hljs-params">(String activityId, Enum&lt;Status&gt; currentStatus)</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">DefaultRefuseResult</span>();<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> Result <span class="hljs-title function_">checkRevoke</span><span class="hljs-params">(String activityId, Enum&lt;Status&gt; currentStatus)</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">DefaultRefuseResult</span>();<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> Result <span class="hljs-title function_">close</span><span class="hljs-params">(String activityId, Enum&lt;Status&gt; currentStatus)</span> &#123;<br>        ActivityService.execStatus(activityId, currentStatus, Status.Close);<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Result</span>(<span class="hljs-string">&quot;0000&quot;</span>, <span class="hljs-string">&quot;活动关闭成功&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> Result <span class="hljs-title function_">open</span><span class="hljs-params">(String activityId, Enum&lt;Status&gt; currentStatus)</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">DefaultRefuseResult</span>();<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> Result <span class="hljs-title function_">doing</span><span class="hljs-params">(String activityId, Enum&lt;Status&gt; currentStatus)</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">DefaultRefuseResult</span>();<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> Result <span class="hljs-title function_">doDefaultNextAction</span><span class="hljs-params">(String activityId, Enum&lt;Status&gt; currentStatus)</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>.close(activityId, currentStatus);<br>    &#125;<br>&#125;<br><br>。。。<br></code></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//定义状态转换机</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">StateMachine</span> &#123;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> Map&lt;Enum&lt;Status&gt;, State&gt; stateMap = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();<br><br><br>    <span class="hljs-keyword">static</span> &#123;<br>        stateMap.put(Status.Check, <span class="hljs-keyword">new</span> <span class="hljs-title class_">CheckState</span>());     <span class="hljs-comment">// 待审核</span><br>        stateMap.put(Status.Close, <span class="hljs-keyword">new</span> <span class="hljs-title class_">CloseState</span>());     <span class="hljs-comment">// 已关闭</span><br>        stateMap.put(Status.Doing, <span class="hljs-keyword">new</span> <span class="hljs-title class_">DoingState</span>());     <span class="hljs-comment">// 活动中</span><br>        stateMap.put(Status.Editing, <span class="hljs-keyword">new</span> <span class="hljs-title class_">EditingState</span>()); <span class="hljs-comment">// 编辑中</span><br>        stateMap.put(Status.Open, <span class="hljs-keyword">new</span> <span class="hljs-title class_">OpenState</span>());       <span class="hljs-comment">// 已开启</span><br>        stateMap.put(Status.Pass, <span class="hljs-keyword">new</span> <span class="hljs-title class_">PassState</span>());       <span class="hljs-comment">// 审核通过</span><br>        stateMap.put(Status.Refuse, <span class="hljs-keyword">new</span> <span class="hljs-title class_">RefuseState</span>());   <span class="hljs-comment">// 审核拒绝</span><br>    &#125;<br><br><br>    <span class="hljs-keyword">public</span> Result <span class="hljs-title function_">arraignment</span><span class="hljs-params">(String activityId, Enum&lt;Status&gt; currentStatus)</span> &#123;<br>        <span class="hljs-keyword">return</span> stateMap.get(currentStatus).arraignment(activityId, currentStatus);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> Result <span class="hljs-title function_">checkPass</span><span class="hljs-params">(String activityId, Enum&lt;Status&gt; currentStatus)</span> &#123;<br>        <span class="hljs-keyword">return</span> stateMap.get(currentStatus).checkPass(activityId, currentStatus);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> Result <span class="hljs-title function_">checkRefuse</span><span class="hljs-params">(String activityId, Enum&lt;Status&gt; currentStatus)</span> &#123;<br>        <span class="hljs-keyword">return</span> stateMap.get(currentStatus).checkRefuse(activityId, currentStatus);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> Result <span class="hljs-title function_">checkRevoke</span><span class="hljs-params">(String activityId, Enum&lt;Status&gt; currentStatus)</span> &#123;<br>        <span class="hljs-keyword">return</span> stateMap.get(currentStatus).checkRevoke(activityId, currentStatus);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> Result <span class="hljs-title function_">close</span><span class="hljs-params">(String activityId, Enum&lt;Status&gt; currentStatus)</span> &#123;<br>        <span class="hljs-keyword">return</span> stateMap.get(currentStatus).close(activityId, currentStatus);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> Result <span class="hljs-title function_">open</span><span class="hljs-params">(String activityId, Enum&lt;Status&gt; currentStatus)</span> &#123;<br>        <span class="hljs-keyword">return</span> stateMap.get(currentStatus).open(activityId, currentStatus);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> Result <span class="hljs-title function_">doing</span><span class="hljs-params">(String activityId, Enum&lt;Status&gt; currentStatus)</span> &#123;<br>        <span class="hljs-keyword">return</span> stateMap.get(currentStatus).doing(activityId, currentStatus);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> Result <span class="hljs-title function_">doDefaultNextAction</span><span class="hljs-params">(String activityId, Enum&lt;Status&gt; currentStatus)</span> &#123;<br>        <span class="hljs-keyword">return</span> stateMap.get(currentStatus).doDefaultNextAction(activityId, currentStatus);<br>    &#125;<br><br>&#125;<br><br></code></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//service类</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ActivityService</span> &#123;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> Map&lt;String, Enum&lt;Status&gt;&gt; currentStatus = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();<br><br><br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">init</span><span class="hljs-params">(String activityId, Enum&lt;Status&gt; initStatus)</span> &#123;<br>        currentStatus.put(activityId, initStatus);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">synchronized</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">execStatus</span><span class="hljs-params">(String activityId, Enum&lt;Status&gt; beforeStatus, Enum&lt;Status&gt; nextStatus)</span> &#123;<br>        <span class="hljs-keyword">if</span> (!currentStatus.get(activityId).equals(beforeStatus)) <span class="hljs-keyword">return</span>;<br>        currentStatus.put(activityId, nextStatus);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> Enum&lt;Status&gt; <span class="hljs-title function_">queryActivityStatus</span><span class="hljs-params">(String activityId)</span> &#123;<br>        <span class="hljs-keyword">return</span> currentStatus.get(activityId);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> ActivityInfo <span class="hljs-title function_">queryActivityInfo</span><span class="hljs-params">(String activityId)</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ActivityInfo</span>() &#123;&#123;<br>            setActivityId(activityId);<br>            setActivityName(<span class="hljs-string">&quot;一个活动&quot;</span>);<br>            setBeginTime(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>());<br>            setEndTime(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>());<br>            setStatus(queryActivityStatus(activityId));<br>        &#125;&#125;;<br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure>
<p>状态机模式将状态和行为封装在各个状态类中，使得代码更加清晰和易于理解，将状态转换和行为分离，使得代码更加模块化，易于维护和扩展，允许通过添加新的状态类来扩展状态机的功能，而无需修改现有的代码，体现开闭原则。</p>
<h3 id="策略模式">策略模式</h3>
<p>策略模式是一种行为型设计模式，主要用于解决在软件构建过程中，某些对象使用的算法可能多种多样，经常发生变化的问题。策略模式的核心思想是定义一系列算法，并将每个算法封装起来，使它们可以相互替换。这样，算法就可以独立于它们的客户变化，从而提高系统的灵活性和可维护性。本案例以营销时的折扣为场景。</p>
<p>目录</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java">strategy<br>    │  IStrategy.java<br>    │<br>    ├─impl<br>    │      DiscountStrategy.java<br>    │      FullReductionStrategy.java<br>    │<br>    └─service<br>            ShopService.java<br></code></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//定义基本策略接口，并实现两种折扣策略</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">IStrategy</span> &#123;<br><br><br>    Double <span class="hljs-title function_">calculateDiscount</span><span class="hljs-params">(Double price)</span>;<br><br>&#125;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DiscountStrategy</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">IStrategy</span> &#123;<br><br>    <span class="hljs-keyword">private</span> Double discount;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">DiscountStrategy</span><span class="hljs-params">(Double discount)</span> &#123;<br>        <span class="hljs-built_in">this</span>.discount = discount;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> Double <span class="hljs-title function_">calculateDiscount</span><span class="hljs-params">(Double price)</span> &#123;<br>        <span class="hljs-keyword">return</span> discount * price;<br>    &#125;<br>&#125;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">FullReductionStrategy</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">IStrategy</span> &#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> Double <span class="hljs-title function_">calculateDiscount</span><span class="hljs-params">(Double price)</span> &#123;<br>        <span class="hljs-keyword">if</span> (price &gt;= <span class="hljs-number">1000</span>) <span class="hljs-keyword">return</span> price - <span class="hljs-number">50</span>;<br>        <span class="hljs-keyword">if</span> (price &gt;= <span class="hljs-number">200</span>) <span class="hljs-keyword">return</span> price - <span class="hljs-number">200</span>;<br>        <span class="hljs-keyword">return</span> price;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//在service类中传入策略</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ShopService</span> &#123;<br><br>    <span class="hljs-keyword">private</span> IStrategy strategy;<br><br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">ShopService</span><span class="hljs-params">(IStrategy strategy)</span> &#123;<br>        <span class="hljs-built_in">this</span>.strategy = strategy;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> Double <span class="hljs-title function_">calculatePrice</span><span class="hljs-params">(Double money)</span> &#123;<br>        <span class="hljs-keyword">return</span> strategy.calculateDiscount(money);<br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure>
<p>策略模式是一种很常见的设计模式，使用策略模式可以使代码的扩展性大大提高，使用策略的时候只需要简单配置就可以进行切换。</p>
<h3 id="模板模式">模板模式</h3>
<p>模板模式也是一种很常见的设计模式，模板模式是基于抽象类定义某一种方法或行为的基本准则，实现类只需实现其中的核心细节，而无需关心流程顺序及其他。这里以实现负载均衡常见的一致性hash算法为例。</p>
<p>目录</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java">template<br>        ArrayListOfConsistentHash.java<br>        BaseConsistentHash.java<br>        TreeMapOfConsistentHash.java<br><br></code></pre></td></tr></table></figure>
<blockquote>
<p>一致性哈希（Consistent Hashing）是一种分布式哈希技术，它可以在节点数量发生变化时，最小化数据重新分布的次数。在一致性哈希中，哈希环是一个连续的哈希值空间，每个节点和数据都映射到这个空间中。当需要添加或删除节点时，只需要重新分配哈希环上相邻节点之间的数据，而不需要重新分配整个哈希环上的数据。</p>
<p>一致性哈希的优点是，当节点数量发生变化时，只需要重新分配哈希环上相邻节点之间的数据，而不需要重新分配整个哈希环上的数据。这样可以大大减少数据重新分布的次数，提高系统的性能和可扩展性。</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//定义基本一致性hash类，把通用的方法和模板流程定义好，子类只需要实现核心的方法即可。</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">BaseConsistentHash</span> &#123;<br><br>    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">add</span><span class="hljs-params">(<span class="hljs-type">long</span> key, String value)</span>;<br><br>    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">Logger</span> <span class="hljs-variable">logger</span> <span class="hljs-operator">=</span> LoggerFactory.getLogger(BaseConsistentHash.class);<br><br>    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">sort</span><span class="hljs-params">()</span> &#123;&#125;<br><br><br>    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">abstract</span> String <span class="hljs-title function_">getFirstNodeValue</span><span class="hljs-params">(String key)</span>;<br><br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">synchronized</span> String <span class="hljs-title function_">process</span><span class="hljs-params">(List&lt;String&gt; values, String key)</span> &#123;<br>        processBefore();<br>        <span class="hljs-keyword">for</span> (String value : values) &#123;<br>            add(hash(value), value);<br>        &#125;<br>        sort();<br>        <span class="hljs-keyword">return</span> getFirstNodeValue(key);<br>    &#125;<br><br>    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">processBefore</span><span class="hljs-params">()</span>;<br><br><br>    <span class="hljs-keyword">public</span> Long <span class="hljs-title function_">hash</span><span class="hljs-params">(String value)</span> &#123;<br>        MessageDigest md5;<br>        <span class="hljs-keyword">try</span> &#123;<br>            md5 = MessageDigest.getInstance(<span class="hljs-string">&quot;MD5&quot;</span>);<br>        &#125; <span class="hljs-keyword">catch</span> (NoSuchAlgorithmException e) &#123;<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(<span class="hljs-string">&quot;MD5 not supported&quot;</span>, e);<br>        &#125;<br>        md5.reset();<br>        <span class="hljs-type">byte</span>[] keyBytes;<br>        keyBytes = value.getBytes(StandardCharsets.UTF_8);<br><br>        md5.update(keyBytes);<br>        <span class="hljs-type">byte</span>[] digest = md5.digest();<br><br>        <span class="hljs-comment">// hash code, Truncate to 32-bits</span><br>        <span class="hljs-type">long</span> <span class="hljs-variable">hashCode</span> <span class="hljs-operator">=</span> ((<span class="hljs-type">long</span>) (digest[<span class="hljs-number">3</span>] &amp; <span class="hljs-number">0xFF</span>) &lt;&lt; <span class="hljs-number">24</span>)<br>                | ((<span class="hljs-type">long</span>) (digest[<span class="hljs-number">2</span>] &amp; <span class="hljs-number">0xFF</span>) &lt;&lt; <span class="hljs-number">16</span>)<br>                | ((<span class="hljs-type">long</span>) (digest[<span class="hljs-number">1</span>] &amp; <span class="hljs-number">0xFF</span>) &lt;&lt; <span class="hljs-number">8</span>)<br>                | (digest[<span class="hljs-number">0</span>] &amp; <span class="hljs-number">0xFF</span>);<br><br>        <span class="hljs-keyword">return</span> hashCode &amp; <span class="hljs-number">0xffffffffL</span>;<br>    &#125;<br><br>&#125;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ArrayListOfConsistentHash</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">BaseConsistentHash</span> &#123;<br><br>    <span class="hljs-keyword">record</span> <span class="hljs-title class_">Pair</span><span class="hljs-params">(</span><br><span class="hljs-params">            Long key,</span><br><span class="hljs-params">            String value</span><br><span class="hljs-params">    )</span> &#123;<br>    &#125;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> ArrayList&lt;Pair&gt; list = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">sort</span><span class="hljs-params">()</span> &#123;<br>        list.sort(Comparator.comparing(Pair::key).thenComparing(Pair::value));<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">add</span><span class="hljs-params">(<span class="hljs-type">long</span> key, String value)</span> &#123;<br>        <span class="hljs-comment">//先搞几个虚拟节点</span><br>        <span class="hljs-type">int</span> <span class="hljs-variable">NODE_SIZE</span> <span class="hljs-operator">=</span> <span class="hljs-number">2</span>;<br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; NODE_SIZE; i++) &#123;<br>            list.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Pair</span>(<span class="hljs-built_in">super</span>.hash(<span class="hljs-string">&quot;node&quot;</span> + i + key), value));<br>        &#125;<br>        list.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Pair</span>(key, value));<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">protected</span> String <span class="hljs-title function_">getFirstNodeValue</span><span class="hljs-params">(String key)</span> &#123;<br>        <span class="hljs-comment">//基于二分实现</span><br>        <span class="hljs-type">Long</span> <span class="hljs-variable">hash</span> <span class="hljs-operator">=</span> hash(key);<br>        <span class="hljs-type">int</span> <span class="hljs-variable">l</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>, r = list.size();<br>        <span class="hljs-keyword">while</span> (l &lt; r) &#123;<br>            <span class="hljs-type">int</span> <span class="hljs-variable">mid</span> <span class="hljs-operator">=</span> l + r &gt;&gt; <span class="hljs-number">1</span>;<br>            <span class="hljs-keyword">if</span> (list.get(mid).key &gt;= hash) r = mid;<br>            <span class="hljs-keyword">else</span> l = mid + <span class="hljs-number">1</span>;<br>        &#125;<br>        <span class="hljs-keyword">return</span> list.get(l).value;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">processBefore</span><span class="hljs-params">()</span> &#123;<br>        list.clear();<br>        logger.info(<span class="hljs-string">&quot;只需arraylist实现的一致性hash&quot;</span>);<br>    &#125;<br>&#125;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TreeMapOfConsistentHash</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">BaseConsistentHash</span>&#123;<br><br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> TreeMap&lt;Long, String&gt; treeMap = <span class="hljs-keyword">new</span> <span class="hljs-title class_">TreeMap</span>&lt;&gt;();<br><br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">NODE_SIZE</span> <span class="hljs-operator">=</span> <span class="hljs-number">2</span>;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 加入一些虚拟节点</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> key key</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> value value</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">add</span><span class="hljs-params">(<span class="hljs-type">long</span> key, String value)</span> &#123;<br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; NODE_SIZE; i++) &#123;<br>            treeMap.put(<span class="hljs-built_in">super</span>.hash(<span class="hljs-string">&quot;node&quot;</span> + key + i), value);<br>        &#125;<br>        treeMap.put(<span class="hljs-built_in">super</span>.hash(String.valueOf(key)), value);<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> key key</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> value</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">protected</span> String <span class="hljs-title function_">getFirstNodeValue</span><span class="hljs-params">(String key)</span> &#123;<br><br>        <span class="hljs-type">Long</span> <span class="hljs-variable">hash</span> <span class="hljs-operator">=</span> <span class="hljs-built_in">super</span>.hash(key);<br>        SortedMap&lt;Long, String&gt; last = treeMap.tailMap(hash);  <span class="hljs-comment">//这个方法返回从这里开始向后的元素(包含这个)</span><br>        <span class="hljs-keyword">if</span> (!last.isEmpty()) &#123;<br>            <span class="hljs-keyword">return</span> last.get(last.firstKey());<br>        &#125;<br>        <span class="hljs-keyword">if</span> (treeMap.isEmpty()) <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalStateException</span>(<span class="hljs-string">&quot;not support&quot;</span>);<br>        <span class="hljs-keyword">return</span> treeMap.firstEntry().getValue();<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">processBefore</span><span class="hljs-params">()</span> &#123;<br>        treeMap.clear();<br>        logger.info(<span class="hljs-string">&quot;只需arraylist实现的一致性hash&quot;</span>);<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure>
<p>模板模式非常适用于一些同类化的实现，模板定义好，只需要实现类实现核心的东西就可以。基本每个框架中我们都可以看到模板模式的身影。</p>
<h3 id="访问者模式">访问者模式</h3>
<p>此设计模式非常高级，也是比较难理解的，它允许在不改变其类的情况下在一个类群上尽可能的添加新的操作。它用于封装一些应用于某种数据结构中的各元素的操作。这里以公司内对不同职位员工的工资发放为例。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java">│  SalaryStructure.java<br>│<br>└─ele<br>        BonusVisitor.java<br>        Element.java<br>        Employee.java<br>        Leader.java<br>        OutsourcedEmployee.java<br>        SalaryVisitor.java<br>        Visitor.java<br><br></code></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//定义element基类，也可以是抽象类</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">Element</span> &#123;<br>  <span class="hljs-keyword">void</span> <span class="hljs-title function_">accept</span><span class="hljs-params">(Visitor visitor)</span>; <span class="hljs-comment">//通常都为accept方法，不知道为什么</span><br>&#125;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Employee</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Element</span> &#123;<br><br>  <span class="hljs-type">int</span> <span class="hljs-variable">monthlySalary</span> <span class="hljs-operator">=</span> <span class="hljs-number">3000</span>;<br><br>  <span class="hljs-type">int</span> <span class="hljs-variable">bonus</span> <span class="hljs-operator">=</span> <span class="hljs-number">500</span>;<br>  <br>  <span class="hljs-meta">@Override</span><br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">accept</span><span class="hljs-params">(Visitor visitor)</span> &#123;<br>      visitor.visit(<span class="hljs-built_in">this</span>);<br>  &#125;<br><br>&#125;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Leader</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Element</span> &#123;<br><br>  <span class="hljs-type">int</span> <span class="hljs-variable">monthlySalary</span> <span class="hljs-operator">=</span> <span class="hljs-number">5000</span>;<br>  <span class="hljs-type">int</span> <span class="hljs-variable">bonus</span> <span class="hljs-operator">=</span> <span class="hljs-number">100</span>;<br>  <br>  <span class="hljs-meta">@Override</span><br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">accept</span><span class="hljs-params">(Visitor visitor)</span> &#123;<br>      visitor.visit(<span class="hljs-built_in">this</span>);<br>  &#125;<br><br>&#125;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OutsourcedEmployee</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Element</span> &#123;<br><br>  <span class="hljs-type">int</span> <span class="hljs-variable">hourlyRate</span> <span class="hljs-operator">=</span> <span class="hljs-number">100</span>;<br><br>  <span class="hljs-type">int</span> <span class="hljs-variable">bonus</span> <span class="hljs-operator">=</span> <span class="hljs-number">30</span>;<br>  <br>  <span class="hljs-meta">@Override</span><br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">accept</span><span class="hljs-params">(Visitor visitor)</span> &#123;<br>    visitor.visit(<span class="hljs-built_in">this</span>);<br>  &#125;<br><br>&#125;<br><br><span class="hljs-comment">//定义visitor接口</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">Visitor</span> &#123;<br>  <span class="hljs-keyword">void</span> <span class="hljs-title function_">visit</span><span class="hljs-params">(Leader leader)</span>;<br>  <span class="hljs-keyword">void</span> <span class="hljs-title function_">visit</span><span class="hljs-params">(Employee employee)</span>;<br>  <span class="hljs-keyword">void</span> <span class="hljs-title function_">visit</span><span class="hljs-params">(OutsourcedEmployee outsourcedEmployee)</span>;<br>&#125;<br><br><span class="hljs-comment">//实现两种visitor</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SalaryVisitor</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Visitor</span> &#123;<br>  <br>  <span class="hljs-meta">@Override</span><br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">visit</span><span class="hljs-params">(Leader leader)</span> &#123;<br>    <span class="hljs-comment">// 假定领导有2倍的基础薪水和额外的奖金</span><br>    <span class="hljs-type">int</span> <span class="hljs-variable">salary</span> <span class="hljs-operator">=</span> leader.monthlySalary * <span class="hljs-number">2</span> + <span class="hljs-number">1000</span>;<br>    System.out.println(<span class="hljs-string">&quot;Pay &quot;</span> + salary + <span class="hljs-string">&quot; to leader&quot;</span>);<br>  &#125;<br><br>  <span class="hljs-meta">@Override</span><br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">visit</span><span class="hljs-params">(Employee employee)</span> &#123;<br>    <span class="hljs-type">int</span> <span class="hljs-variable">salary</span> <span class="hljs-operator">=</span> employee.monthlySalary;<br>    System.out.println(<span class="hljs-string">&quot;Pay &quot;</span> + salary + <span class="hljs-string">&quot; to employee&quot;</span>);<br>  &#125;<br><br>  <span class="hljs-meta">@Override</span><br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">visit</span><span class="hljs-params">(OutsourcedEmployee outsourcedEmployee)</span> &#123;<br>    <span class="hljs-comment">// 假定外包员工按小时支付，每月工作160小时</span><br>    <span class="hljs-type">int</span> <span class="hljs-variable">salary</span> <span class="hljs-operator">=</span> outsourcedEmployee.hourlyRate * <span class="hljs-number">160</span>;<br>    System.out.println(<span class="hljs-string">&quot;Pay &quot;</span> + salary + <span class="hljs-string">&quot; to outsourced employee&quot;</span>);<br>  &#125;<br>&#125;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">BonusVisitor</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Visitor</span> &#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">visit</span><span class="hljs-params">(Leader leader)</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;Pay &quot;</span> + leader.bonus + <span class="hljs-string">&quot; to leader&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">visit</span><span class="hljs-params">(Employee employee)</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;Pay &quot;</span> + employee.bonus + <span class="hljs-string">&quot; to employee&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">visit</span><span class="hljs-params">(OutsourcedEmployee outsourcedEmployee)</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;Pay &quot;</span> + outsourcedEmployee.bonus + <span class="hljs-string">&quot; to outsourcedEmployee&quot;</span>);<br>    &#125;<br>&#125;<br><br><span class="hljs-comment">//定义数据看板</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SalaryStructure</span> &#123;<br>  <span class="hljs-keyword">private</span> List&lt;Element&gt; elements;<br><br>  <span class="hljs-keyword">public</span> <span class="hljs-title function_">SalaryStructure</span><span class="hljs-params">()</span> &#123;<br>    elements = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();<br>    <span class="hljs-comment">// 这部分可以根据实际需求来生成对象</span><br>    elements.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Leader</span>());<br>    elements.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Employee</span>());<br>    elements.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">OutsourcedEmployee</span>());<br>  &#125;<br><br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">show</span><span class="hljs-params">(Visitor visitor)</span> &#123;<br>    <span class="hljs-keyword">for</span> (Element element : elements) &#123;<br>      element.accept(visitor);<br>    &#125;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<p>从此案例中可以看出，通过访问者模式拓展了计算工资和奖金的功能。但是访问者模式它的设计还是比较复杂难懂的。访问者模式通过将数据结构和操作分离，提供了一种灵活、可扩展、易于维护的解决方案，适用于需要对数据结构进行多种不同操作的场景。(不懂这句话)</p>
<h3 id="总结">总结</h3>
<p>设计模式就这样草草结束了…</p>

                
              </div>
            
            <hr/>
            <div>
              <div class="post-metas my-3">
  
    <div class="post-meta mr-3 d-flex align-items-center">
      <i class="iconfont icon-category"></i>
      

<span class="category-chains">
  
  
    
      <span class="category-chain">
        
  <a href="/categories/%E5%90%8E%E7%AB%AF/" class="category-chain-item">后端</a>
  
  

      </span>
    
  
</span>

    </div>
  
  
    <div class="post-meta">
      <i class="iconfont icon-tags"></i>
      
        <a href="/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/">#设计模式</a>
      
    </div>
  
</div>


              
  

  <div class="license-box my-3">
    <div class="license-title">
      <div>设计模式</div>
      <div>http://example.com/2024/03/20/设计模式/</div>
    </div>
    <div class="license-meta">
      
        <div class="license-meta-item">
          <div>作者</div>
          <div>ykexc</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>发布于</div>
          <div>2024年3月20日</div>
        </div>
      
      
      
        <div class="license-meta-item">
          <div>许可协议</div>
          <div>
            
              
              
                <a target="_blank" href="https://creativecommons.org/licenses/by/4.0/">
                  <span class="hint--top hint--rounded" aria-label="BY - 署名">
                    <i class="iconfont icon-by"></i>
                  </span>
                </a>
              
            
          </div>
        </div>
      
    </div>
    <div class="license-icon iconfont"></div>
  </div>



              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2024/03/21/LeetCode-W125/" title="LeetCode-W125">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">LeetCode-W125</span>
                        <span class="visible-mobile">上一篇</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2024/03/17/%E6%8D%A2%E8%B7%9FDP/" title="换跟DP">
                        <span class="hidden-mobile">换跟DP</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      

    </div>
  </div>
</div>





  



  



  



  



  


  
  








    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">
  
    <div class="footer-content">
       <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> 
    </div>
  
  
  
  
</div>

  </footer>

  <!-- Scripts -->
  
  <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://lib.baomitu.com/jquery/3.6.0/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>


  <script  src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        typing(text);
      
    })(window, document);
  </script>




  
    <script  src="/js/img-lazyload.js" ></script>
  




  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/tocbot/4.18.2/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init(Object.assign({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      scrollSmooth    : true,
      includeTitleTags: true,
      headingsOffset  : -boardTop,
    }, CONFIG.toc));
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }

    Fluid.events.registerRefreshCallback(function() {
      if ('tocbot' in window) {
        tocbot.refresh();
        var toc = jQuery('#toc');
        if (toc.length === 0 || !tocbot) {
          return;
        }
        if (toc.find('.toc-list-item').length > 0) {
          toc.css('visibility', 'visible');
        }
      }
    });
  });
</script>


  <script src=https://lib.baomitu.com/clipboard.js/2.0.11/clipboard.min.js></script>

  <script>Fluid.plugins.codeWidget();</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/4.3.1/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));

    Fluid.events.registerRefreshCallback(function() {
      if ('anchors' in window) {
        anchors.removeAll();
        var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
        var res = [];
        for (var item of el) {
          res.push('.markdown-body > ' + item.trim());
        }
        if (CONFIG.anchorjs.placement === 'left') {
          anchors.options.class = 'anchorjs-link-left';
        }
        anchors.add(res.join(', '));
      }
    });
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  <script  src="/js/local-search.js" ></script>

  <script defer src="/js/leancloud.js" ></script>





<!-- 主题的启动项，将它保持在最底部 -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">博客在允许 JavaScript 运行的环境下浏览效果更佳</div>
  </noscript>
</body>
</html>
